<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/webpack-guidebook/umi.css" />
    <script>
      window.routerBase = "/webpack-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.20
    </script>
    <title>Plugin æœºåˆ¶</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/webpack-guidebook-favicon.svg&#x27;)" href="/webpack-guidebook//">Webpack Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/webpack-guidebook//basic-summary">åŸºæœ¬ç»¼è¿°</a><a aria-current="page" class="active" href="/webpack-guidebook//principle-analysis">åŸç†åˆ†æ</a><a href="/webpack-guidebook//best-practice">æœ€ä½³å®è·µ</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/webpack-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/webpack-guidebook-favicon.svg&#x27;)" href="/webpack-guidebook//"></a><h1>Webpack Guidebook</h1><p>Webpack å®Œå…¨çŸ¥è¯†ä½“ç³»</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/webpack-guidebook//basic-summary">åŸºæœ¬ç»¼è¿°</a></li><li><a aria-current="page" class="active" href="/webpack-guidebook//principle-analysis">åŸç†åˆ†æ</a></li><li><a href="/webpack-guidebook//best-practice">æœ€ä½³å®è·µ</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/webpack-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/webpack-guidebook//principle-analysis/babel">Babel</a></li><li><a href="/webpack-guidebook//principle-analysis/operational-principle">å·¥ä½œåŸç†</a><ul><li><a href="/webpack-guidebook//principle-analysis/operational-principle/file-watch"><span>æ–‡ä»¶ç›‘å¬</span></a></li><li><a href="/webpack-guidebook//principle-analysis/operational-principle/hot-module-replacement"><span>æ¨¡å—çƒ­æ›´æ–°</span></a></li><li><a href="/webpack-guidebook//principle-analysis/operational-principle/filenames-hashes"><span>æ–‡ä»¶æŒ‡çº¹ç­–ç•¥</span></a></li><li><a href="/webpack-guidebook//principle-analysis/operational-principle/tree-shaking"><span>Tree Shaking</span></a></li><li><a href="/webpack-guidebook//principle-analysis/operational-principle/scope-hoisting"><span>ä½œç”¨åŸŸæå‡</span></a></li><li><a href="/webpack-guidebook//principle-analysis/operational-principle/sourcemap"><span>SourceMap</span></a></li></ul></li><li><a aria-current="page" class="active" href="/webpack-guidebook//principle-analysis/implementation-principle">åº•å±‚åŸç†</a><ul><li><a href="/webpack-guidebook//principle-analysis/implementation-principle/workflow"><span>æ„å»ºæµç¨‹</span></a></li><li><a href="/webpack-guidebook//principle-analysis/implementation-principle/simple-implementation"><span>ç®€æ˜“å®ç°</span></a></li><li><a href="/webpack-guidebook//principle-analysis/implementation-principle/source-code-analysis"><span>æºç åˆ†æ</span></a></li><li><a href="/webpack-guidebook//principle-analysis/implementation-principle/tapable"><span>Tapable</span></a></li><li><a href="/webpack-guidebook//principle-analysis/implementation-principle/compiler"><span>Compiler</span></a></li><li><a href="/webpack-guidebook//principle-analysis/implementation-principle/compilation"><span>Compilation</span></a></li><li><a href="/webpack-guidebook//principle-analysis/implementation-principle/loader"><span>Loader æœºåˆ¶</span></a></li><li><a aria-current="page" class="active" href="/webpack-guidebook//principle-analysis/implementation-principle/plugin"><span>Plugin æœºåˆ¶</span></a></li><li><a href="/webpack-guidebook//principle-analysis/implementation-principle/ast"><span>æŠ½è±¡è¯­æ³•æ ‘</span></a></li></ul></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="æ’ä»¶çš„åŸºæœ¬ç»“æ„" data-depth="2" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#æ’ä»¶çš„åŸºæœ¬ç»“æ„"><span>æ’ä»¶çš„åŸºæœ¬ç»“æ„</span></a></li><li title="æ„å»ºæµç¨‹" data-depth="2" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#æ„å»ºæµç¨‹"><span>æ„å»ºæµç¨‹</span></a></li><li title="ç†è§£äº‹ä»¶æµæœºåˆ¶ Tapable" data-depth="2" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#ç†è§£äº‹ä»¶æµæœºåˆ¶-tapable"><span>ç†è§£äº‹ä»¶æµæœºåˆ¶ Tapable</span></a></li><li title="Tapable ç”¨æ³•" data-depth="3" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#tapable-ç”¨æ³•"><span>Tapable ç”¨æ³•</span></a></li><li title="å®ç°ç®€æ˜“åŒæ­¥é’©å­" data-depth="3" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#å®ç°ç®€æ˜“åŒæ­¥é’©å­"><span>å®ç°ç®€æ˜“åŒæ­¥é’©å­</span></a></li><li title="Tapable å¦‚ä½•ä¸æ’ä»¶å…³è”" data-depth="3" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#tapable-å¦‚ä½•ä¸æ’ä»¶å…³è”"><span>Tapable å¦‚ä½•ä¸æ’ä»¶å…³è”</span></a></li><li title="ç†è§£ Compiler è´Ÿè´£ç¼–è¯‘" data-depth="2" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#ç†è§£-compiler-è´Ÿè´£ç¼–è¯‘"><span>ç†è§£ Compiler è´Ÿè´£ç¼–è¯‘</span></a></li><li title="ç†è§£ Compilation è´Ÿè´£åˆ›å»º bundle" data-depth="2" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#ç†è§£-compilation-è´Ÿè´£åˆ›å»º-bundle"><span>ç†è§£ Compilation è´Ÿè´£åˆ›å»º bundle</span></a></li><li title="Compiler å’Œ Compilation çš„åŒºåˆ«" data-depth="2" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#compiler-å’Œ-compilation-çš„åŒºåˆ«"><span>Compiler å’Œ Compilation çš„åŒºåˆ«</span></a></li><li title="å¸¸ç”¨ API" data-depth="2" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#å¸¸ç”¨-api"><span>å¸¸ç”¨ API</span></a></li><li title="è¯»å–è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–" data-depth="3" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#è¯»å–è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–"><span>è¯»å–è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–</span></a></li><li title="ç›‘å¬æ–‡ä»¶å˜åŒ–" data-depth="3" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#ç›‘å¬æ–‡ä»¶å˜åŒ–"><span>ç›‘å¬æ–‡ä»¶å˜åŒ–</span></a></li><li title="ä¿®æ”¹è¾“å‡ºèµ„æº" data-depth="3" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#ä¿®æ”¹è¾“å‡ºèµ„æº"><span>ä¿®æ”¹è¾“å‡ºèµ„æº</span></a></li><li title="åˆ¤æ–­ Webpack ä½¿ç”¨äº†å“ªäº›æ’ä»¶" data-depth="3" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#åˆ¤æ–­-webpack-ä½¿ç”¨äº†å“ªäº›æ’ä»¶"><span>åˆ¤æ–­ Webpack ä½¿ç”¨äº†å“ªäº›æ’ä»¶</span></a></li><li title="æ–‡ä»¶å†™å…¥" data-depth="3" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#æ–‡ä»¶å†™å…¥"><span>æ–‡ä»¶å†™å…¥</span></a></li><li title="å¼‚å¸¸æˆ–è­¦å‘Šå¤„ç†" data-depth="3" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#å¼‚å¸¸æˆ–è­¦å‘Šå¤„ç†"><span>å¼‚å¸¸æˆ–è­¦å‘Šå¤„ç†</span></a></li><li title="æ’ä»¶æ‰©å±•ï¼šç¼–å†™æ’ä»¶çš„æ’ä»¶" data-depth="3" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#æ’ä»¶æ‰©å±•ï¼šç¼–å†™æ’ä»¶çš„æ’ä»¶"><span>æ’ä»¶æ‰©å±•ï¼šç¼–å†™æ’ä»¶çš„æ’ä»¶</span></a></li><li title="å¼€å‘è°ƒè¯•" data-depth="2" class=""><a href="/webpack-guidebook//principle-analysis/implementation-principle/plugin#å¼€å‘è°ƒè¯•"><span>å¼€å‘è°ƒè¯•</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="plugin-æœºåˆ¶"><a aria-hidden="true" href="#plugin-æœºåˆ¶"><span class="icon icon-link"></span></a>Plugin æœºåˆ¶</h1><p>é€šè¿‡æ’ä»¶æˆ‘ä»¬å¯ä»¥æ‰©å±• webpackï¼Œåœ¨åˆé€‚çš„æ—¶æœºé€šè¿‡ Webpack æä¾›çš„ API æ”¹å˜è¾“å‡ºç»“æœï¼Œä½¿ Webpack å¯ä»¥æ‰§è¡Œæ›´å¹¿æ³›çš„ä»»åŠ¡ï¼Œæ‹¥æœ‰æ›´å¼ºçš„æ„å»ºèƒ½åŠ›ã€‚</p><p>æœ¬æ–‡å°†å°è¯•æ¢ç´¢ Webpack æ’ä»¶çš„å·¥ä½œæµç¨‹ï¼Œè¿›è€Œå»æ­ç§˜å®ƒçš„å·¥ä½œåŸç†ã€‚åŒæ—¶éœ€è¦ä½ å¯¹ Webpack åº•å±‚å’Œæ„å»ºæµç¨‹çš„ä¸€äº›ä¸œè¥¿æœ‰ä¸€å®šçš„äº†è§£ã€‚</p><p>æƒ³è¦äº†è§£ webpack çš„æ’ä»¶çš„æœºåˆ¶ï¼Œéœ€è¦å¼„æ˜ç™½ä»¥ä¸‹å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><ol><li>ä¸€ä¸ªç®€å•çš„æ’ä»¶çš„æ„æˆ</li><li>Webpack æ„å»ºæµç¨‹</li><li>Tapable æ˜¯å¦‚ä½•æŠŠå„ä¸ªæ’ä»¶ä¸²è”åˆ°ä¸€èµ·çš„</li><li><code>compiler</code> ä»¥åŠ <code>compilation</code> å¯¹è±¡çš„ä½¿ç”¨ä»¥åŠå®ƒä»¬å¯¹åº”çš„äº‹ä»¶é’©å­ã€‚</li></ol><h2 id="æ’ä»¶çš„åŸºæœ¬ç»“æ„"><a aria-hidden="true" href="#æ’ä»¶çš„åŸºæœ¬ç»“æ„"><span class="icon icon-link"></span></a>æ’ä»¶çš„åŸºæœ¬ç»“æ„</h2><p><code>plugins</code> æ˜¯å¯ä»¥ç”¨è‡ªèº«åŸå‹æ–¹æ³• <code>apply</code> æ¥å®ä¾‹åŒ–çš„å¯¹è±¡ã€‚<code>apply</code> åªåœ¨å®‰è£…æ’ä»¶è¢« Webpack çš„ <code>compiler</code> æ‰§è¡Œä¸€æ¬¡ã€‚<code>apply</code> æ–¹æ³•ä¼ å…¥ä¸€ä¸ª webpck <code>compiler</code> çš„å¼•ç”¨ï¼Œæ¥è®¿é—®ç¼–è¯‘å™¨å›è°ƒã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="class HelloPlugin {
  // åœ¨æ„é€ å‡½æ•°ä¸­è·å–ç”¨æˆ·ç»™è¯¥æ’ä»¶ä¼ å…¥çš„é…ç½®
  constructor(options) {
    // ...
  }

  // Webpack ä¼šè°ƒç”¨ HelloPlugin å®ä¾‹çš„ apply æ–¹æ³•ç»™æ’ä»¶å®ä¾‹ä¼ å…¥ compiler å¯¹è±¡
  apply(compiler) {
    // åœ¨ emit é˜¶æ®µæ’å…¥é’©å­å‡½æ•°ï¼Œç”¨äºç‰¹å®šæ—¶æœºå¤„ç†é¢å¤–çš„é€»è¾‘
    compiler.hooks.emit.tap(&#x27;HelloPlugin&#x27;, compilation =&gt; {
      // åœ¨åŠŸèƒ½æµç¨‹å®Œæˆåå¯ä»¥è°ƒç”¨ Webpack æä¾›çš„å›è°ƒå‡½æ•°
    });

    // å¦‚æœäº‹ä»¶æ˜¯å¼‚æ­¥çš„ï¼Œä¼šå¸¦ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼Œåœ¨æ’ä»¶å¤„ç†å®Œæˆä»»åŠ¡æ—¶éœ€è¦è°ƒç”¨å›è°ƒå‡½æ•°é€šçŸ¥ Webpackï¼Œæ‰ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªå¤„ç†æµç¨‹
    compiler.plugin(&#x27;emit&#x27;, function(compilation, callback) {
      // æ”¯æŒå¤„ç†é€»è¾‘
      // å¤„ç†å®Œæ¯•åæ‰§è¡Œ callback ä»¥é€šçŸ¥ Webpack
      // å¦‚æœä¸æ‰§è¡Œ callbackï¼Œè¿è¡Œæµç¨‹å°†ä¼šä¸€è‡´å¡åœ¨è¿™ä¸å¾€ä¸‹æ‰§è¡Œ
      callback();
    });
  }
}

module.exports = HelloPlugin;
" data-status="copy"></button><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">HelloPlugin</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// åœ¨æ„é€ å‡½æ•°ä¸­è·å–ç”¨æˆ·ç»™è¯¥æ’ä»¶ä¼ å…¥çš„é…ç½®</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// Webpack ä¼šè°ƒç”¨ HelloPlugin å®ä¾‹çš„ apply æ–¹æ³•ç»™æ’ä»¶å®ä¾‹ä¼ å…¥ compiler å¯¹è±¡</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// åœ¨ emit é˜¶æ®µæ’å…¥é’©å­å‡½æ•°ï¼Œç”¨äºç‰¹å®šæ—¶æœºå¤„ç†é¢å¤–çš„é€»è¾‘</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    compiler</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">emit</span><span class="token punctuation">.</span><span class="token method function property-access">tap</span><span class="token punctuation">(</span><span class="token string">&#x27;HelloPlugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">compilation</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// åœ¨åŠŸèƒ½æµç¨‹å®Œæˆåå¯ä»¥è°ƒç”¨ Webpack æä¾›çš„å›è°ƒå‡½æ•°</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// å¦‚æœäº‹ä»¶æ˜¯å¼‚æ­¥çš„ï¼Œä¼šå¸¦ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼Œåœ¨æ’ä»¶å¤„ç†å®Œæˆä»»åŠ¡æ—¶éœ€è¦è°ƒç”¨å›è°ƒå‡½æ•°é€šçŸ¥ Webpackï¼Œæ‰ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªå¤„ç†æµç¨‹</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    compiler</span><span class="token punctuation">.</span><span class="token method function property-access">plugin</span><span class="token punctuation">(</span><span class="token string">&#x27;emit&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token parameter punctuation">,</span><span class="token parameter"> callback</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// æ”¯æŒå¤„ç†é€»è¾‘</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// å¤„ç†å®Œæ¯•åæ‰§è¡Œ callback ä»¥é€šçŸ¥ Webpack</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// å¦‚æœä¸æ‰§è¡Œ callbackï¼Œè¿è¡Œæµç¨‹å°†ä¼šä¸€è‡´å¡åœ¨è¿™ä¸å¾€ä¸‹æ‰§è¡Œ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">HelloPlugin</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>ä½¿ç”¨æ’ä»¶æ—¶ï¼Œåªéœ€è¦å°†å®ƒçš„å®ä¾‹æ”¾åˆ° Webpack çš„ Plugins æ•°ç»„é…ç½®ä¸­ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const HelloPlugin = require(&#x27;./hello-plugin.js&#x27;);

module.exports = {
  plugins: [new HelloPlugin({ options: true })],
};
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">HelloPlugin</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./hello-plugin.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  plugins</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">HelloPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> options</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>å…ˆæ¥åˆ†æä»¥ä¸‹ Webpack Plugin çš„å·¥ä½œåŸç†ï¼š</p><ol><li>è¯»å–é…ç½®çš„è¿‡ç¨‹ä¸­ä¼šå…ˆæ‰§è¡Œ <code>new HelloPlugin(options)</code> åˆå§‹åŒ–ä¸€ä¸ª <code>HelloPlugin</code> è·å¾—å…¶å®ä¾‹</li><li>åˆå§‹åŒ– <code>compiler</code> å¯¹è±¡åè°ƒç”¨ <code>HelloPlugin.apply(compiler)</code> ç»™æ’ä»¶å®ä¾‹ä¼ å…¥ <code>compiler</code> å¯¹è±¡</li><li>æ’ä»¶å®ä¾‹åœ¨è·å–åˆ° <code>compiler</code> å¯¹è±¡åï¼Œå°±å¯ä»¥é€šè¿‡ <code>compiler.plugin(äº‹ä»¶åç§°, å›è°ƒå‡½æ•°)</code> ç›‘å¬åˆ° Webpack å¹¿æ’­å‡ºæ¥çš„äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ <code>compiler</code> å¯¹è±¡å»æ“ä½œ Webpack</li></ol><h2 id="æ„å»ºæµç¨‹"><a aria-hidden="true" href="#æ„å»ºæµç¨‹"><span class="icon icon-link"></span></a>æ„å»ºæµç¨‹</h2><p>åœ¨ç¼–å†™æ’ä»¶ä¹‹å‰ï¼Œè¿˜éœ€è¦äº†è§£ä»¥ä¸‹ Webpack çš„æ„å»ºæµç¨‹ï¼Œä»¥ä¾¿åœ¨åˆé€‚çš„æ—¶æœºæ’å…¥åˆé€‚çš„æ’ä»¶é€»è¾‘ã€‚</p><p>Webpack çš„åŸºæœ¬æ„å»ºæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>æ ¡éªŒé…ç½®æ–‡ä»¶ï¼šè¯»å–å‘½ä»¤è¡Œä¼ å…¥æˆ–è€… <code>webpack.config.js</code> æ–‡ä»¶ï¼Œåˆå§‹åŒ–æœ¬æ¬¡æ„å»ºçš„é…ç½®å‚æ•°</li><li>ç”Ÿæˆ <code>Compiler</code> å¯¹è±¡ï¼šæ‰§è¡Œé…ç½®æ–‡ä»¶ä¸­çš„æ’ä»¶å®ä¾‹åŒ–è¯­å¥ <code>new MyWebpackPlugin()</code>ï¼Œä¸º Webpack äº‹ä»¶æµæŒ‚ä¸Šè‡ªå®šä»¥ Hooks</li><li>è¿›å…¥ <code>entryOption</code> é˜¶æ®µï¼šWebpack å¼€å§‹è¯»å–é…ç½®çš„ Entriesï¼Œé€’å½’éå†æ‰€æœ‰çš„å…¥å£æ–‡ä»¶</li><li><code>run/watch</code>ï¼šå¦‚æœè¿è¡Œåœ¨ <code>watch</code> æ¨¡å¼åˆ™æ‰§è¡Œ <code>watch</code> æ–¹æ³•ï¼Œå¦åˆ™æ‰§è¡Œ <code>run</code> æ–¹æ³•</li><li><code>compilation</code>ï¼šåˆ›å»º <code>Compilation</code> å¯¹è±¡å›è°ƒ <code>compilation</code> ç›¸å…³é’©å­ï¼Œä¾æ¬¡è¿›å…¥æ¯ä¸ªå…¥å£æ–‡ä»¶ï¼ˆ<code>entry</code>ï¼‰ï¼Œä½¿ç”¨ loader å¯¹æ–‡ä»¶è¿›è¡Œç¼–è¯‘ã€‚é€šè¿‡ <code>compilation</code> å¯ä»¥è¯»å–åˆ° <code>module</code> çš„ <code>resource</code>ï¼ˆèµ„æºè·¯å¾„ï¼‰ã€<code>loaders</code>ï¼ˆä½¿ç”¨åˆ°çš„ loaderï¼‰ç­‰ä¿¡æ¯ã€‚å†å°†ç¼–è¯‘å¥½çš„æ–‡ä»¶å†…å®¹ä½¿ç”¨ <code>acorn</code> è§£æç”Ÿæˆ AST é™æ€è¯­æ³•æ ‘ã€‚ç„¶åé€’å½’ã€é‡å¤çš„æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œæ‰€æœ‰æ¨¡å—å’Œä¾èµ–åˆ†æå®Œæˆåï¼Œæ‰§è¡Œ <code>compilation</code> çš„ <code>seal</code> æ–¹æ³•å¯¹æ¯ä¸ª Chunk è¿›è¡Œæ•´ç†ã€ä¼˜åŒ–ã€å°è£… <code>__webpack_require__</code> æ¥æ¨¡æ‹Ÿæ¨¡å—åŒ–æ“ä½œ</li><li><code>emit</code>ï¼šæ‰€æœ‰æ–‡ä»¶çš„ç¼–è¯‘åŠè½¬åŒ–éƒ½å·²ç»å®Œæˆï¼ŒåŒ…å«äº†æœ€ç»ˆè¾“å‡ºçš„èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¼ å…¥äº‹ä»¶å›è°ƒçš„ <code>compilation.assets</code> ä¸Šæ‹¿åˆ°æ‰€éœ€æ•°æ®ï¼Œå…¶ä¸­åŒ…æ‹¬å³å°†è¾“å‡ºçš„èµ„æºã€ä»£ç å— Chunk ç­‰ä¿¡æ¯</li></ol><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// ä¿®æ”¹æˆ–æ·»åŠ èµ„æº
compilation.assets[&#x27;net-file.js&#x27;] = {
  source() {
    return &#x27;var a=1&#x27;;
  },
  size() {
    return this.source().length;
  },
};
" data-status="copy"></button><div class="token-line"><span class="token comment">// ä¿®æ”¹æˆ–æ·»åŠ èµ„æº</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">compilation</span><span class="token punctuation">.</span><span class="token property-access">assets</span><span class="token punctuation">[</span><span class="token string">&#x27;net-file.js&#x27;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token string">&#x27;var a=1&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ol start="7"><li><code>afterEmit</code>ï¼šæ–‡ä»¶å·²ç»å†™å…¥ç£ç›˜å®Œæˆ</li><li><code>done</code>ï¼šå®Œæˆç¼–è¯‘</li></ol></div><img alt="Webpackæ‰§è¡Œæµç¨‹" src="/webpack-guidebook/static/webpack-compile-workflow.914d192d.jpeg" width="640"/><div class="markdown"><p><a href="https://blog.didiyun.com/index.php/2019/03/01/webpack/" target="_blank" rel="noopener noreferrer">Webpack ç¼–è¯‘æµç¨‹å›¾<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="ç†è§£äº‹ä»¶æµæœºåˆ¶-tapable"><a aria-hidden="true" href="#ç†è§£äº‹ä»¶æµæœºåˆ¶-tapable"><span class="icon icon-link"></span></a>ç†è§£äº‹ä»¶æµæœºåˆ¶ Tapable</h2><p>Webpack æœ¬è´¨ä¸Šæ˜¯ä¸€ç§äº‹ä»¶æµçš„æœºåˆ¶ï¼Œå®ƒçš„å·¥ä½œæµç¨‹å°±æ˜¯å°†å„ä¸ªæ’ä»¶ä¸²è”èµ·æ¥ï¼Œè€Œå®ç°è¿™ä¸€åˆ‡çš„æ ¸å¿ƒå°±æ˜¯ Tapableã€‚</p><p>Webpack çš„ Tapable äº‹ä»¶æµæœºåˆ¶ä¿è¯äº†æ’ä»¶çš„æœ‰åºæ€§ï¼Œå°†å„ä¸ªæ’ä»¶ä¸²è”èµ·æ¥ï¼ŒWebpack åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šå¹¿æ’­äº‹ä»¶ï¼Œæ’ä»¶åªéœ€è¦ç›‘å¬å®ƒæ‰€å…³å¿ƒçš„äº‹ä»¶ï¼Œå°±èƒ½å‡å¦‚åˆ°è¿™æ¡ Webpack æœºåˆ¶ä¸­ï¼Œå»æ”¹å˜ Webpack çš„è¿ä½œï¼Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿæ‰©å±•æ€§è‰¯å¥½ã€‚</p><p><code>Tapable</code> ä¹Ÿæ˜¯ä¸€ä¸ªå°å‹çš„ libraryï¼Œæ˜¯ Webpack çš„æ ¸å¿ƒå·¥å…·ã€‚ç±»ä¼¼äº Node ä¸­çš„ <code>events</code> åº“ï¼Œæ ¸å¿ƒåŸç†å°±æ˜¯ä¸€ä¸ªè®¢é˜…å‘å¸ƒæ¨¡å¼ã€‚ä½œç”¨æ˜¯æä¾›ç±»ä¼¼çš„æ’ä»¶æ¥å£ã€‚</p><p>Webpack ä¸­æœ€æ ¸å¿ƒçš„ <strong>è´Ÿè´£ç¼–è¯‘çš„ Compiler</strong> å’Œ <strong>è´Ÿè´£ bundles çš„ Compilation</strong> éƒ½æ˜¯ <code>Tapable</code> çš„å®ä¾‹ï¼Œå¯ä»¥ç›´æ¥åœ¨ Compiler å’Œ Compilation å¯¹è±¡ä¸Šå¹¿æ’­å’Œç›‘å¬äº‹ä»¶ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="/**
 * å¹¿æ’­äº‹ä»¶
 * event-name ä¸ºäº‹ä»¶åç§°ï¼Œæ³¨æ„ä¸è¦å’Œç°æœ‰çš„äº‹ä»¶é‡å
 */
compiler.apply(&#x27;event-name&#x27;, params);
compilation.apply(&#x27;event-name&#x27;, params);

/**
 * ç›‘å¬äº‹ä»¶
 */
compiler.plugin(&#x27;event-name&#x27;, function(params) {});
compilation.plugin(&#x27;event-name&#x27;, function(params) {});
" data-status="copy"></button><div class="token-line"><span class="token doc-comment comment">/**</span></div><div class="token-line"><span class="token doc-comment comment"> * å¹¿æ’­äº‹ä»¶</span></div><div class="token-line"><span class="token doc-comment comment"> * event-name ä¸ºäº‹ä»¶åç§°ï¼Œæ³¨æ„ä¸è¦å’Œç°æœ‰çš„äº‹ä»¶é‡å</span></div><div class="token-line"><span class="token doc-comment comment"> */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">compiler</span><span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span><span class="token string">&#x27;event-name&#x27;</span><span class="token punctuation">,</span><span class="token plain"> params</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">compilation</span><span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span><span class="token string">&#x27;event-name&#x27;</span><span class="token punctuation">,</span><span class="token plain"> params</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token doc-comment comment"></span></div><div class="token-line"><span class="token doc-comment comment">/**</span></div><div class="token-line"><span class="token doc-comment comment"> * ç›‘å¬äº‹ä»¶</span></div><div class="token-line"><span class="token doc-comment comment"> */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">compiler</span><span class="token punctuation">.</span><span class="token method function property-access">plugin</span><span class="token punctuation">(</span><span class="token string">&#x27;event-name&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">compilation</span><span class="token punctuation">.</span><span class="token method function property-access">plugin</span><span class="token punctuation">(</span><span class="token string">&#x27;event-name&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>Tapable</code> ç±»æš´éœ²äº† <code>tap</code>ã€<code>tapAsync</code> å’Œ <code>tapPromise</code> æ–¹æ³•ï¼Œå¯ä»¥æ ¹æ®é’©å­çš„åŒæ­¥/å¼‚æ­¥æ–¹å¼æ¥é€‰æ‹©ä¸€ä¸ªå‡½æ•°æ³¨å…¥é€»è¾‘ã€‚</p><p>ğŸŒ° <strong><code>tap</code> åŒæ­¥é’©å­</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="compiler.hooks.compile.tap(&#x27;MyPlugin&#x27;, params =&gt; {
  console.log(&#x27;ä»¥åŒæ­¥æ–¹å¼è§¦åŠ compile é’©å­ã€‚&#x27;);
});
" data-status="copy"></button><div class="token-line"><span class="token plain">compiler</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">compile</span><span class="token punctuation">.</span><span class="token method function property-access">tap</span><span class="token punctuation">(</span><span class="token string">&#x27;MyPlugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">params</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;ä»¥åŒæ­¥æ–¹å¼è§¦åŠ compile é’©å­ã€‚&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>ğŸŒ° <strong><code>tapAsync</code> å¼‚æ­¥é’©å­</strong></p><p>é€šè¿‡ <code>callback</code> å›è°ƒå‘Šè¯‰ Webpack å¼‚æ­¥æ‰§è¡Œå®Œæ¯• <code>tapPromise</code> å¼‚æ­¥é’©å­ï¼Œè¿”å›ä¸€ä¸ª Promise å‘Šè¯‰ Webpack å¼‚æ­¥æ‰§è¡Œå®Œæ¯•ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="compiler.hooks.run.tapAsync(&#x27;MyPlugin&#x27;, (compiler, callback) =&gt; {
  console.log(&#x27;ä»¥å¼‚æ­¥æ–¹å¼è§¦åŠ run é’©å­ã€‚&#x27;);
  callback();
});

compiler.hooks.run.tapPromise(&#x27;MyPlugin&#x27;, compiler =&gt; {
  return new Promise(resolve =&gt; setTimeout(resolve, 1000)).then(() =&gt; {
    console.log(&#x27;ä»¥å…·æœ‰å»¶è¿Ÿçš„å¼‚æ­¥æ–¹å¼è§¦åŠ run é’©å­&#x27;);
  });
});
" data-status="copy"></button><div class="token-line"><span class="token plain">compiler</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">run</span><span class="token punctuation">.</span><span class="token method function property-access">tapAsync</span><span class="token punctuation">(</span><span class="token string">&#x27;MyPlugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token parameter punctuation">,</span><span class="token parameter"> callback</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;ä»¥å¼‚æ­¥æ–¹å¼è§¦åŠ run é’©å­ã€‚&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">compiler</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">run</span><span class="token punctuation">.</span><span class="token method function property-access">tapPromise</span><span class="token punctuation">(</span><span class="token string">&#x27;MyPlugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">compiler</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token plain">resolve</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;ä»¥å…·æœ‰å»¶è¿Ÿçš„å¼‚æ­¥æ–¹å¼è§¦åŠ run é’©å­&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="tapable-ç”¨æ³•"><a aria-hidden="true" href="#tapable-ç”¨æ³•"><span class="icon icon-link"></span></a>Tapable ç”¨æ³•</h3><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const {
  SyncHook,
  SyncBailHook,
  SyncWaterfallHook,
  SynLoopHook,
  AsyncParallelHook,
  AsyncParallelBailHook,
  AsyncSeriesHook,
  ASyncSeriesBailHook,
  AsyncSeriesWaterfallHook,
} = require(&#x27;tapable&#x27;);
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">SyncHook</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">SyncBailHook</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">SyncWaterfallHook</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">SynLoopHook</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">AsyncParallelHook</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">AsyncParallelBailHook</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">ASyncSeriesBailHook</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">AsyncSeriesWaterfallHook</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;tapable&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li><code>Sync*</code> åŒæ­¥<ul><li><code>SyncHook</code> åŒæ­¥é’©å­</li><li><code>SyncBailHook</code> åŒæ­¥ä¿é™©é’©å­</li><li><code>SyncLoopHook</code> åŒæ­¥å¾ªç¯é’©å­</li><li><code>SyncWaterfallHook</code> åŒæ­¥ç€‘å¸ƒé’©å­</li></ul></li><li><code>Async*</code> å¼‚æ­¥<ul><li><code>AsyncParallel*</code> å¼‚æ­¥å¹¶è¡Œ<ul><li><code>AsyncParallelHook</code> å¼‚æ­¥</li><li><code>AsyncParallelBailHook</code> å¼‚æ­¥å¹¶è¡Œä¿é™©é’©å­</li></ul></li><li><code>AsyncSeries*</code> å¼‚æ­¥ä¸²è¡Œ<ul><li><code>AsyncSeriesHook</code> å¼‚æ­¥ä¸²è¡Œé’©å­</li><li><code>AsyncSeriesBailHook</code> å¼‚æ­¥ä¸²è¡Œä¿é™©é’©å­</li><li><code>AsyncSeriesWaterfallHook</code> å¼‚æ­¥ä¸²è¡Œç€‘å¸ƒé’©å­</li></ul></li></ul></li></ul><h3 id="å®ç°ç®€æ˜“åŒæ­¥é’©å­"><a aria-hidden="true" href="#å®ç°ç®€æ˜“åŒæ­¥é’©å­"><span class="icon icon-link"></span></a>å®ç°ç®€æ˜“åŒæ­¥é’©å­</h3><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="class Hook {
  constructor(args) {
    this.taps = [];
    this.interceptors = []; // è¿™ä¸ªæ”¾åœ¨åé¢ç”¨
    this._args = args;
  }
  tap(name, fn) {
    this.taps.push({ name, fn });
  }
}

class SyncHook extends Hook {
  call(name, fn) {
    try {
      this.taps.forEach(tap =&gt; tap.fn(name));
      fn(null, name);
    } catch (error) {
      fn(error);
    }
  }
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">Hook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">taps</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">interceptors</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// è¿™ä¸ªæ”¾åœ¨åé¢ç”¨</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">_args</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> args</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token parameter punctuation">,</span><span class="token parameter"> fn</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">taps</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">,</span><span class="token plain"> fn </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">SyncHook</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> </span><span class="token class-name">Hook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token parameter punctuation">,</span><span class="token parameter"> fn</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">try</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">taps</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">tap</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> tap</span><span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span><span class="token plain"> name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">catch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="tapable-å¦‚ä½•ä¸æ’ä»¶å…³è”"><a aria-hidden="true" href="#tapable-å¦‚ä½•ä¸æ’ä»¶å…³è”"><span class="icon icon-link"></span></a>Tapable å¦‚ä½•ä¸æ’ä»¶å…³è”</h3><p><strong>Compile.js</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const { AsyncSeriesHook, SyncHook } = require(&#x27;tapable&#x27;);

// åˆ›å»ºç±»
class Compiler {
  constructor() {
    this.hooks = {
      // å¼‚æ­¥é’©å­
      run: new AsyncSeriesHook([&#x27;compiler&#x27;]),
      // åŒæ­¥é’©å­
      compile: new SyncHook([&#x27;params&#x27;]),
    };
  }

  run() {
    // æ‰§è¡Œå¼‚æ­¥é’©å­
    this.hooks.run.callAsync(this, err =&gt; {
      this.compile(onCompiled);
    });
  }

  compile() {
    // æ‰§è¡ŒåŒæ­¥é’©å­ å¹¶ä¼ å‚
    this.hooks.compile.call(params);
  }
}

module.exports = Compile;
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;tapable&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// åˆ›å»ºç±»</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">Compiler</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// å¼‚æ­¥é’©å­</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      run</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;compiler&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// åŒæ­¥é’©å­</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      compile</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;params&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// æ‰§è¡Œå¼‚æ­¥é’©å­</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">run</span><span class="token punctuation">.</span><span class="token method function property-access">callAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">compile</span><span class="token punctuation">(</span><span class="token plain">onCompiled</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// æ‰§è¡ŒåŒæ­¥é’©å­ å¹¶ä¼ å‚</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token method function property-access">compile</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain">params</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Compile</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><strong>MyPlugin.js</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const Compiler = require(&#x27;./compiler&#x27;);

class MyPlugin {
  // æ¥å— compiler å‚æ•°
  apply(compiler) {
    compiler.hooks.run.tap(&#x27;MyPlugin&#x27;, () =&gt; console.log(&#x27;å¼€å§‹ç¼–è¯‘...&#x27;));
    compiler.hooks.compiler.tapAsync(&#x27;MyPlugin&#x27;, (name, age) =&gt; {
      setTimeout(() =&gt; {
        console.log(&#x27;ç¼–è¯‘ä¸­&#x27;);
      }, 1000);
    });
  }
}

// è¿™é‡Œç±»ä¼¼äº webpack.config.js çš„ Plugins é…ç½®
// å‘ Plugins å±æ€§ä¼ å…¥ new å®ä¾‹

const myPlugin = new MyPlugin();

const options = {
  plugins: [myPlugin],
};

let compiler = new Compiler(options);
compiler.run();
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Compiler</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./compiler&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">MyPlugin</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// æ¥å— compiler å‚æ•°</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    compiler</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">run</span><span class="token punctuation">.</span><span class="token method function property-access">tap</span><span class="token punctuation">(</span><span class="token string">&#x27;MyPlugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;å¼€å§‹ç¼–è¯‘...&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    compiler</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">compiler</span><span class="token punctuation">.</span><span class="token method function property-access">tapAsync</span><span class="token punctuation">(</span><span class="token string">&#x27;MyPlugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token parameter punctuation">,</span><span class="token parameter"> age</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;ç¼–è¯‘ä¸­&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// è¿™é‡Œç±»ä¼¼äº webpack.config.js çš„ Plugins é…ç½®</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// å‘ Plugins å±æ€§ä¼ å…¥ new å®ä¾‹</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> myPlugin </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> options </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  plugins</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">myPlugin</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> compiler </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Compiler</span><span class="token punctuation">(</span><span class="token plain">options</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">compiler</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="ç†è§£-compiler-è´Ÿè´£ç¼–è¯‘"><a aria-hidden="true" href="#ç†è§£-compiler-è´Ÿè´£ç¼–è¯‘"><span class="icon icon-link"></span></a>ç†è§£ Compiler è´Ÿè´£ç¼–è¯‘</h2><p>å¼€å‘æ’ä»¶é¦–å…ˆè¦çŸ¥é“ <code>compiler</code> å’Œ <code>compilation</code> å¯¹è±¡æ˜¯åšä»€ä¹ˆçš„ã€‚</p><p><code>Compiler</code> å¯¹è±¡åŒ…å«äº†å½“å‰è¿è¡Œ Webpack çš„é…ç½®ï¼ŒåŒ…æ‹¬ <code>entry</code>ã€<code>output</code>ã€<code>loader</code> ç­‰é…ç½®ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨å¯åŠ¨ Webpack æ—¶è¢«å®ä¾‹åŒ–ï¼Œè€Œä¸”æ˜¯å…¨å±€å”¯ä¸€çš„ã€‚<code>Plugin</code> å¯ä»¥é€šè¿‡è¯¥å¯¹è±¡è·å–åˆ° Webpack çš„é…ç½®ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚</p><p>å¦‚æœçœ‹å®Œè¿™æ®µè¯ï¼Œä½ è¿˜æ˜¯æ²¡ç†è§£ <code>compiler</code> æ˜¯åšå•¥çš„ï¼Œä¸è¦æ€•ã€‚è¿è¡Œ <code>npm run build</code>ï¼ŒæŠŠ <code>compiler</code> çš„å…¨éƒ¨ä¿¡æ¯è¾“å‡ºåˆ°æ§åˆ¶å°ä¸Š <code>console.log(compiler)</code>ã€‚</p></div><img alt="Compilerå¯¹è±¡å®ä¾‹" src="/webpack-guidebook/static/console-compiler.6ef45e6f.png" width="720"/><div class="markdown"><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Compiler {
  _pluginCompat: SyncBailHook {},
  hooks: {
    shouldEmit: SyncBailHook {
      // ...
    },
    done: AsyncSeriesHook {
      // ...
    },
    additionalPass: AsyncSerirsHook {
      // ...
    },
    beforeRun: AsyncSeriesHook {
      // ...
    },
    run: AsyncSeriesHook {
      // ...
    },
    emit: AsyncSeriesHook {
      // ...
    },
    assetEmitted: AsyncSeriesHook {
      // ...
    },
    afterEmit: AsyncSeriesHook {
      // ...
    },
    thisCompilation: SyncHook {
      // ...
    },
    compilation: SyncHook {
      // ...
    },
    normalModuleFactory: SyncHook {
      // ...
    },
    contextModuleFacotry: SyncHook {
      // ...
    },
    beforeCompile: AsyncSeriesHook {
      // ...
    },
    compile: SyncHook {
      // ...
    },
    make: AsyncParallelHook {
      // ...
    },
    afterCompile: AsyncSeriesHook {
      // ...
    },
    watchRun: AsyncSeriesHook {
      // ...
    },
    failed: SyncHook {
      // ...
    },
    invalid: SyncHook {
      // ...
    },
    watchClose: SyncHook {
      // ...
    },
    infrastructureLog: SyncBailHook {
      // ...
    },
    environment: SyncHook {
      // ...
    },
    afterEnvironment: SyncHook {
      // ...
    },
    afterPlugins: SyncHook {
      // ...
    },
    afterResolvers: SyncHook {
      // ...
    },
    entryOption: SyncBailHook {
      // ...
    },
    infrastructurelog: SyncBailHook {
      // ...
    }
  },
  outputPath: &#x27;&#x27;, // è¾“å‡ºç›®å½•
  outputFileSystem: NodeOutputFileSystem {
    // ...
  },
  inputFileSystem: CachedInputFileSystem {
    // ...
  },
  options: {
    // Compiler å¯¹è±¡åŒ…å«äº† Webpack çš„æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼Œentryã€moduleã€outputã€resolve ç­‰ä¿¡æ¯
    entry: [
      &#x27;babel-polyfill&#x27;,
      &#x27;/Users/mrsingsing/Webpack-Guidebook/example/demo/src/index.js&#x27;
    ],
    devServer: {
      port: 3000
    },
    output: {
      // ...
    },
    module: {
      // ...
    },
    plugins: [ MyWebpackPlugin {} ],
    mode: &#x27;production&#x27;,
    context: &#x27;/Users/mrsingsing/Webpack-Guidebook/example/demo/src/webpack-plugin&#x27;,
    devtool: false,
    performance: {
      maxAssetSize: 250000,
      maxEntrypointSize: 250000,
      hints: &#x27;warning&#x27;,
    },
    optimization: {
      // ...
    },
    resolve: {
      // ...
    },
    resolveLoader: {
      // ...
    },
    infrastructureLogging: {
      level: &#x27;info&#x27;,
      debug: false,
    }
  },
  context: &#x27;/Users/mrsingsing/Webpack-Guidebook/example/demo/src/webpack-plugin&#x27;, // ä¸Šä¸‹æ–‡ï¼Œæ–‡ä»¶ç›®å½•
  requestShortener: RequestShortener {
    // ...
  },
  watchFileSystem: NodeWatchFileSystem {
    // ç›‘å¬æ–‡ä»¶å˜åŒ–åˆ—è¡¨ä¿¡æ¯
  }
}
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Compiler</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  _pluginCompat</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncBailHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  hooks</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    shouldEmit</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncBailHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    done</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    additionalPass</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSerirsHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    beforeRun</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    run</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    emit</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    assetEmitted</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    afterEmit</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    thisCompilation</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    compilation</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    normalModuleFactory</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    contextModuleFacotry</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    beforeCompile</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    compile</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    make</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncParallelHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    afterCompile</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    watchRun</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    failed</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    invalid</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    watchClose</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    infrastructureLog</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncBailHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    environment</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    afterEnvironment</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    afterPlugins</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    afterResolvers</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entryOption</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncBailHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    infrastructurelog</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">SyncBailHook</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  outputPath</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// è¾“å‡ºç›®å½•</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  outputFileSystem</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">NodeOutputFileSystem</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  inputFileSystem</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">CachedInputFileSystem</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  options</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// Compiler å¯¹è±¡åŒ…å«äº† Webpack çš„æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼Œentryã€moduleã€outputã€resolve ç­‰ä¿¡æ¯</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&#x27;babel-polyfill&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&#x27;/Users/mrsingsing/Webpack-Guidebook/example/demo/src/index.js&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    devServer</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      port</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">3000</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    output</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    module</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    plugins</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token maybe-class-name">MyWebpackPlugin</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    mode</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;production&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    context</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;/Users/mrsingsing/Webpack-Guidebook/example/demo/src/webpack-plugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    devtool</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token dom variable">performance</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      maxAssetSize</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">250000</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      maxEntrypointSize</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">250000</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      hints</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;warning&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    optimization</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    resolve</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    resolveLoader</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    infrastructureLogging</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      level</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;info&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      debug</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  context</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;/Users/mrsingsing/Webpack-Guidebook/example/demo/src/webpack-plugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// ä¸Šä¸‹æ–‡ï¼Œæ–‡ä»¶ç›®å½•</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  requestShortener</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">RequestShortener</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  watchFileSystem</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">NodeWatchFileSystem</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ç›‘å¬æ–‡ä»¶å˜åŒ–åˆ—è¡¨ä¿¡æ¯</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>Compiler æºç ç²¾ç®€ç‰ˆä»£ç è§£æ</p><p><a href="https://github.com/webpack/webpack/blob/master/lib/Compiler.js" target="_blank" rel="noopener noreferrer">æºç åœ°å€<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const { SyncHook, SyncBailHook, AsyncSeriesHook } = require(&#x27;tapable&#x27;);

class Compiler {
  constructor() {
    // 1. å®šä¹‰ç”Ÿå‘½å‘¨æœŸé’©å­
    this.hooks = Object.freeze({
      // ...åªåˆ—ä¸¾å‡ ä¸ªå¸¸ç”¨çš„å¸¸è§é’©å­ï¼Œæ›´å¤š Hook å°±ä¸åˆ—ä¸¾äº†ï¼Œæœ‰å…´è¶£çœ‹æºç 
      done: new AsyncSeriesHook([&#x27;stats&#x27;]), // ä¸€æ¬¡ç¼–è¯‘å®Œæˆåæ‰§è¡Œï¼Œå›è°ƒå‚æ•°ï¼šstats
      beforeRun: new AsyncSeriesHook([&#x27;compiler&#x27;]),
      run: new AsyncSeriesHook([&#x27;compiler&#x27;]), // åœ¨ç¼–è¯‘å™¨å¼€å§‹è¯»å–è®°å½•å‰æ‰§è¡Œ
      emit: new AsyncSeriesHook([&#x27;compilation&#x27;]), // åœ¨ç”Ÿæˆæ–‡ä»¶åˆ° output ç›®å½•ä¹‹å‰æ‰§è¡Œï¼Œå›è°ƒå‚æ•°ï¼šcompilation
      afterEmit: new AsyncSeriesHook([&#x27;compilation&#x27;]), // åœ¨ç”Ÿæˆæ–‡ä»¶åˆ° output ç›®å½•ä¹‹åæ‰§è¡Œ
      compilation: new SyncHook([&#x27;compilation&#x27;, &#x27;params&#x27;]), // åœ¨ä¸€æ¬¡ compilation åˆ›å»ºåæ‰§è¡Œæ‰§è¡Œæ’ä»¶
      beforeCompile: new AsyncSeriesHook([&#x27;params&#x27;]),
      compile: new SyncHook([&#x27;params&#x27;]), // åœ¨ä¸€ä¸ªæ–°çš„ compilation åˆ›å»ºä¹‹å‰æ‰§è¡Œ
      make: new AsyncParallelHook([&#x27;compilation&#x27;]), // å®Œæˆä¸€æ¬¡ç¼–è¯‘ä¹‹å‰æ‰§è¡Œ
      afterCompile: new AsyncSeriesHook([&#x27;compilation&#x27;]),
      watchRun: new AsyncSeriesHook([&#x27;compiler&#x27;]),
      failed: new SyncHook([&#x27;error&#x27;]),
      watchClose: new SyncHook([]),
      afterPlugins: new SyncHook([&#x27;compiler&#x27;]),
      entryOption: new SyncBailHook([&#x27;context&#x27;, &#x27;entry&#x27;]),
    });
  }
  newCompilation() {
    // åˆ›å»º Compilation å¯¹è±¡å›è°ƒ compilation ç›¸å…³é’©å­
    const compilation = new Compilation(this);

    // çœç•¥

    this.hooks.compilation.call(compilation, params); // compilation å¯¹è±¡åˆ›å»ºå®Œæˆ
    return compilation;
  }
  watch() {
    // å¦‚æœè¿è¡Œåœ¨ watch æ¨¡å¼åˆ™æ‰§è¡Œ watch æ–¹æ³•ï¼Œå¦åˆ™æ‰§è¡Œ run æ–¹æ³•
    if (this.running) {
      return handler(new ConcurrentCompilationError());
    }
    this.running = true;
    this.watchMode = true;
    return new Watching(this, watchOptions, handler);
  }
  run(callback) {
    if (this.running) {
      return callback(new ConcurrentCompilationError());
    }
    this.running = true;
    process.nextTick(() =&gt; {
      this.emitAssets(compilation, err =&gt; {
        if (err) {
          // åœ¨ç¼–è¯‘å’Œè¾“å‡ºçš„æµç¨‹ä¸­é‡åˆ°å¼‚å¸¸æ—¶ï¼Œä¼šè§¦å‘ failed äº‹ä»¶
          this.hooks.failed.call(err);
        }
        if (compilation.hooks.needAdditionalPass.call()) {
          // ...
          // done å®Œæˆç¼–è¯‘
          this.hooks.done.callAsync(stats, err =&gt; {
            // åˆ›å»º compilation å¯¹è±¡ä¹‹å‰
            this.compile(onCompiled);
          });
        }
        this.emitRecords(err =&gt; {
          this.hooks.done.callAsync(stats, err =&gt; {
            // ...
          });
        });
      });
    });

    this.hooks.beforeRun.callAsync(this, err =&gt; {
      this.hooks.run.callAsync(this, err =&gt; {
        this.readRecords(err =&gt; {
          this.compile(onCompiled);
        });
      });
    });
  }
  compile(callback) {
    const params = this.newCompilationParams();
    this.hooks.beforeCompile.callAsync(params, err =&gt; {
      this.hooks.beforeCompile.call(params);
      const compilation = this.newCompilation(params);
      // è§¦å‘ make äº‹ä»¶å¹¶è°ƒç”¨ addEntryï¼Œæ‰¾åˆ°å…¥å£ JSï¼Œè¿›è¡Œä¸‹ä¸€æ­¥
      this.hooks.make.callAsync(compilation, err =&gt; {
        process.nextTick(() =&gt; {
          compilation.finish(err =&gt; {
            // å°è£…æ„å»ºç»“æœï¼ˆsealï¼‰ï¼Œé€æ¬¡å¯¹æ¯ä¸ª module å’Œ chunk è¿›è¡Œæ•´ç†ï¼Œæ¯ä¸ª chunk å¯¹åº”ä¸€ä¸ªå…¥å£æ–‡ä»¶
            compilation.seal(err =&gt; {
              this.hooks.afterCompile.callAsync(compilation, err =&gt; {
                // å¼‚æ­¥çš„äº‹ä»¶éœ€è¦åœ¨æ’ä»¶å¤„ç†å®Œæˆä»»åŠ¡æ—¶è°ƒç”¨å›è°ƒå‡½æ•°é€šçŸ¥ Webpack è¿›å…¥ä¸‹ä¸€ä¸ªæµç¨‹
                // ä¸ç„¶è¿è¡Œæµç¨‹å°†ä¼šä¸€ç›´ä½§åœ¨è¿™ä¸å¾€ä¸‹æ‰§è¡Œ
                return callback(null, compilation);
              });
            });
          });
        });
      });
    });
  }
  emitAssets(compilation, callback) {
    const emitFiles = err =&gt; {
      // ...çœç•¥
      // afterEmitï¼šæ–‡ä»¶å·²ç»å†™å…¥ç£ç›˜å®Œæˆ
      this.hooks.afterEmit.callAsync(compilation, err =&gt; {
        if (err) return callback(err);
        return callback();
      });
    };

    // emit äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¯ä»¥è¯»å–åˆ°æœ€ç»ˆè¾“å‡ºçš„èµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–ï¼Œå¹¶è¿›è¡Œä¿®æ”¹ï¼ˆè¿™æ˜¯æœ€åä¸€æ¬¡ä¿®æ”¹æœ€ç»ˆæ–‡ä»¶çš„æœºä¼šï¼‰
    this.hooks.emit.callAsync(compilation, err =&gt; {
      if (err) return callback(err);
      outputPath = compilation.getPath(this.outputPath, {});
      mkdirp(this.outputFileSystem, outputPath, emitFiles);
    });
  }
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token maybe-class-name">SyncHook</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token maybe-class-name">SyncBailHook</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSeriesHook</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;tapable&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">Compiler</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 1. å®šä¹‰ç”Ÿå‘½å‘¨æœŸé’©å­</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...åªåˆ—ä¸¾å‡ ä¸ªå¸¸ç”¨çš„å¸¸è§é’©å­ï¼Œæ›´å¤š Hook å°±ä¸åˆ—ä¸¾äº†ï¼Œæœ‰å…´è¶£çœ‹æºç </span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      done</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;stats&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// ä¸€æ¬¡ç¼–è¯‘å®Œæˆåæ‰§è¡Œï¼Œå›è°ƒå‚æ•°ï¼šstats</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      beforeRun</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;compiler&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      run</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;compiler&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// åœ¨ç¼–è¯‘å™¨å¼€å§‹è¯»å–è®°å½•å‰æ‰§è¡Œ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      emit</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;compilation&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// åœ¨ç”Ÿæˆæ–‡ä»¶åˆ° output ç›®å½•ä¹‹å‰æ‰§è¡Œï¼Œå›è°ƒå‚æ•°ï¼šcompilation</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      afterEmit</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;compilation&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// åœ¨ç”Ÿæˆæ–‡ä»¶åˆ° output ç›®å½•ä¹‹åæ‰§è¡Œ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      compilation</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;compilation&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;params&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// åœ¨ä¸€æ¬¡ compilation åˆ›å»ºåæ‰§è¡Œæ‰§è¡Œæ’ä»¶</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      beforeCompile</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;params&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      compile</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;params&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// åœ¨ä¸€ä¸ªæ–°çš„ compilation åˆ›å»ºä¹‹å‰æ‰§è¡Œ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      make</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">AsyncParallelHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;compilation&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// å®Œæˆä¸€æ¬¡ç¼–è¯‘ä¹‹å‰æ‰§è¡Œ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      afterCompile</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;compilation&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      watchRun</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;compiler&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      failed</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;error&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      watchClose</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      afterPlugins</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;compiler&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      entryOption</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">SyncBailHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;context&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;entry&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">newCompilation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// åˆ›å»º Compilation å¯¹è±¡å›è°ƒ compilation ç›¸å…³é’©å­</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> compilation </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Compilation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// çœç•¥</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token method function property-access">compilation</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain">compilation</span><span class="token punctuation">,</span><span class="token plain"> params</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// compilation å¯¹è±¡åˆ›å»ºå®Œæˆ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> compilation</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// å¦‚æœè¿è¡Œåœ¨ watch æ¨¡å¼åˆ™æ‰§è¡Œ watch æ–¹æ³•ï¼Œå¦åˆ™æ‰§è¡Œ run æ–¹æ³•</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">running</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">ConcurrentCompilationError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">running</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">watchMode</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Watching</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token plain"> watchOptions</span><span class="token punctuation">,</span><span class="token plain"> handler</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">running</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">ConcurrentCompilationError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">running</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    process</span><span class="token punctuation">.</span><span class="token method function property-access">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">emitAssets</span><span class="token punctuation">(</span><span class="token plain">compilation</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// åœ¨ç¼–è¯‘å’Œè¾“å‡ºçš„æµç¨‹ä¸­é‡åˆ°å¼‚å¸¸æ—¶ï¼Œä¼šè§¦å‘ failed äº‹ä»¶</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token method function property-access">failed</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">compilation</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token method function property-access">needAdditionalPass</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// done å®Œæˆç¼–è¯‘</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">done</span><span class="token punctuation">.</span><span class="token method function property-access">callAsync</span><span class="token punctuation">(</span><span class="token plain">stats</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token comment">// åˆ›å»º compilation å¯¹è±¡ä¹‹å‰</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">compile</span><span class="token punctuation">(</span><span class="token plain">onCompiled</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">emitRecords</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">done</span><span class="token punctuation">.</span><span class="token method function property-access">callAsync</span><span class="token punctuation">(</span><span class="token plain">stats</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">beforeRun</span><span class="token punctuation">.</span><span class="token method function property-access">callAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">run</span><span class="token punctuation">.</span><span class="token method function property-access">callAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">readRecords</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">compile</span><span class="token punctuation">(</span><span class="token plain">onCompiled</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> params </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">newCompilationParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">beforeCompile</span><span class="token punctuation">.</span><span class="token method function property-access">callAsync</span><span class="token punctuation">(</span><span class="token plain">params</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token method function property-access">beforeCompile</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token plain">params</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">const</span><span class="token plain"> compilation </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">newCompilation</span><span class="token punctuation">(</span><span class="token plain">params</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// è§¦å‘ make äº‹ä»¶å¹¶è°ƒç”¨ addEntryï¼Œæ‰¾åˆ°å…¥å£ JSï¼Œè¿›è¡Œä¸‹ä¸€æ­¥</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">make</span><span class="token punctuation">.</span><span class="token method function property-access">callAsync</span><span class="token punctuation">(</span><span class="token plain">compilation</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        process</span><span class="token punctuation">.</span><span class="token method function property-access">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          compilation</span><span class="token punctuation">.</span><span class="token method function property-access">finish</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token comment">// å°è£…æ„å»ºç»“æœï¼ˆsealï¼‰ï¼Œé€æ¬¡å¯¹æ¯ä¸ª module å’Œ chunk è¿›è¡Œæ•´ç†ï¼Œæ¯ä¸ª chunk å¯¹åº”ä¸€ä¸ªå…¥å£æ–‡ä»¶</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            compilation</span><span class="token punctuation">.</span><span class="token method function property-access">seal</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">afterCompile</span><span class="token punctuation">.</span><span class="token method function property-access">callAsync</span><span class="token punctuation">(</span><span class="token plain">compilation</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token comment">// å¼‚æ­¥çš„äº‹ä»¶éœ€è¦åœ¨æ’ä»¶å¤„ç†å®Œæˆä»»åŠ¡æ—¶è°ƒç”¨å›è°ƒå‡½æ•°é€šçŸ¥ Webpack è¿›å…¥ä¸‹ä¸€ä¸ªæµç¨‹</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token comment">// ä¸ç„¶è¿è¡Œæµç¨‹å°†ä¼šä¸€ç›´ä½§åœ¨è¿™ä¸å¾€ä¸‹æ‰§è¡Œ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span><span class="token plain"> compilation</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">emitAssets</span><span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token parameter punctuation">,</span><span class="token parameter"> callback</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">emitFiles</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// ...çœç•¥</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// afterEmitï¼šæ–‡ä»¶å·²ç»å†™å…¥ç£ç›˜å®Œæˆ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">afterEmit</span><span class="token punctuation">.</span><span class="token method function property-access">callAsync</span><span class="token punctuation">(</span><span class="token plain">compilation</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// emit äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¯ä»¥è¯»å–åˆ°æœ€ç»ˆè¾“å‡ºçš„èµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–ï¼Œå¹¶è¿›è¡Œä¿®æ”¹ï¼ˆè¿™æ˜¯æœ€åä¸€æ¬¡ä¿®æ”¹æœ€ç»ˆæ–‡ä»¶çš„æœºä¼šï¼‰</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">emit</span><span class="token punctuation">.</span><span class="token method function property-access">callAsync</span><span class="token punctuation">(</span><span class="token plain">compilation</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      outputPath </span><span class="token operator">=</span><span class="token plain"> compilation</span><span class="token punctuation">.</span><span class="token method function property-access">getPath</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">outputPath</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">mkdirp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">outputFileSystem</span><span class="token punctuation">,</span><span class="token plain"> outputPath</span><span class="token punctuation">,</span><span class="token plain"> emitFiles</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>apply</code> æ–¹æ³•ä¸­æ’å…¥é’©å­çš„ä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// compiler æä¾›äº† compiler.hooksï¼Œå¯ä»¥æ ¹æ®è¿™äº›ä¸åŒçš„æ—¶åˆ»å»è®©æ’ä»¶åšä¸åŒçš„äº‹æƒ…
compiler.hooks.é˜¶æ®µ.tapå‡½æ•°(&#x27;æ’ä»¶åç§°&#x27;, é˜¶æ®µå›è°ƒå‚æ•° =&gt; {
  // do something
});

compiler.run(callback);
" data-status="copy"></button><div class="token-line"><span class="token comment">// compiler æä¾›äº† compiler.hooksï¼Œå¯ä»¥æ ¹æ®è¿™äº›ä¸åŒçš„æ—¶åˆ»å»è®©æ’ä»¶åšä¸åŒçš„äº‹æƒ…</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">compiler</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">é˜¶æ®µ</span><span class="token punctuation">.</span><span class="token method function property-access">tapå‡½æ•°</span><span class="token punctuation">(</span><span class="token string">&#x27;æ’ä»¶åç§°&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token parameter">é˜¶æ®µå›è°ƒå‚æ•°</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// do something</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">compiler</span><span class="token punctuation">.</span><span class="token method function property-access">run</span><span class="token punctuation">(</span><span class="token plain">callback</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="ç†è§£-compilation-è´Ÿè´£åˆ›å»º-bundle"><a aria-hidden="true" href="#ç†è§£-compilation-è´Ÿè´£åˆ›å»º-bundle"><span class="icon icon-link"></span></a>ç†è§£ Compilation è´Ÿè´£åˆ›å»º bundle</h2><p>Compilation å¯¹è±¡ä»£è¡¨äº†ä¸€æ¬¡èµ„æºç‰ˆæœ¬æ„å»ºã€‚å½“è¿è¡Œ Webpack å¼€å‘ç¯å¢ƒä¸­é—´ä»¶æ—¶ï¼Œæ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªæ–‡ä»¶å˜åŒ–ï¼Œå°±ä¼šåˆ›å»ºæ–°çš„ <code>compilation</code>ï¼Œä»è€Œç”Ÿæˆä¸€ç»„æ–°çš„ç¼–è¯‘èµ„æºã€‚ä¸€ä¸ª <code>Compilation</code> å¯¹è±¡è¡¨ç°äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ã€ä»¥åŠè¢«è·Ÿè¸ªä¾èµ–çš„çŠ¶æ€ä¿¡æ¯ï¼Œç®€å•æ¥è®²å°±æ˜¯æŠŠæœ¬æ¬¡æ‰“åŒ…ç¼–è¯‘çš„å†…å®¹å­˜åˆ°å†…å­˜é‡Œã€‚Compilation å¯¹è±¡ä¹Ÿæä¾›äº†æ’ä»¶éœ€è¦è‡ªå®šä¹‰åŠŸèƒ½çš„å›è°ƒï¼Œä»¥ä¾›æ’ä»¶åšè‡ªå®šä¹‰å¤„ç†æ—¶é€‰æ‹©ä½¿ç”¨æ‹“å±•ã€‚</p><p>ç®€å•æ¥è¯´ï¼ŒCompilation çš„èŒè´£å°±æ˜¯æ„å»ºæ¨¡å—å’Œ Chunkï¼Œå¹¶åˆ©ç”¨æ’ä»¶ä¼˜åŒ–æ„å»ºè¿‡ç¨‹ã€‚</p><p>å’Œ Compiler ç”¨æ³•ç›¸åŒï¼Œé’©å­ç±»å‹ä¸åŒï¼Œä¹Ÿå¯ä»¥åœ¨æŸäº›é’©å­ä¸Šè®¿é—® <code>tapAsync</code> å’Œ <code>tapPromise</code>ã€‚</p><p>æ§åˆ¶å°è¾“å‡º <code>console.log(compilation)</code>ï¼š</p></div><img alt="Compilation" src="/webpack-guidebook/static/console-compilation.8d98d6bd.png" width="720"/><div class="markdown"><p>é€šè¿‡ Compilation ä¹Ÿèƒ½è¯»å–åˆ° Compiler å¯¹è±¡ã€‚</p><p>å¸¸ç”¨ Compilation Hooksï¼š</p><table><thead><tr><th>é’©å­</th><th>ç±»å‹</th><th>è°ƒç”¨æ—¶æœº</th></tr></thead><tbody><tr><td>buildModule</td><td>SyncHook</td><td>åœ¨æ¨¡å—å¼€å§‹ç¼–è¯‘ä¹‹å‰è§¦å‘ï¼Œå¯ä»¥ç”¨äºä¿®æ”¹æ¨¡å—</td></tr><tr><td>succeedModule</td><td>SyncHook</td><td>å½“ä¸€ä¸ªæ¨¡å—è¢«æˆåŠŸç¼–è¯‘ï¼Œä¼šæ‰§è¡Œè¿™ä¸ªé’©å­</td></tr><tr><td>finishModules</td><td>AsyncSeriesHook</td><td>å½“æ‰€æœ‰æ¨¡å—éƒ½ç¼–è¯‘æˆåŠŸåè¢«è°ƒç”¨</td></tr><tr><td>seal</td><td>SyncHook</td><td>å½“ä¸€æ¬¡ <code>compilation</code> åœæ­¢æ¥æ”¶æ–°æ¨¡å—æ—¶è§¦å‘</td></tr><tr><td>optimizeDependencies</td><td>SyncBailHook</td><td>åœ¨ä¾èµ–ä¼˜åŒ–çš„å¼€å§‹æ‰§è¡Œ</td></tr><tr><td>optimize</td><td>SyncHook</td><td>åœ¨ä¼˜åŒ–é˜¶æ®µçš„å¼€å§‹æ‰§è¡Œ</td></tr><tr><td>optimizeModules</td><td>SyncBailHook</td><td>åœ¨æ¨¡å—ä¼˜åŒ–é˜¶æ®µå¼€å§‹æ—¶æ‰§è¡Œï¼Œæ’ä»¶å¯ä»¥åœ¨è¿™ä¸ªé’©å­é‡Œæ‰§è¡Œå¯¹æ¨¡å—çš„ä¼˜åŒ–ï¼Œå›è°ƒå‚æ•°ï¼š<code>modules</code></td></tr><tr><td>optimizeChunks</td><td>SyncBailHook</td><td>åœ¨ä»£ç å—ä¼˜åŒ–é˜¶æ®µå¼€å§‹æ—¶æ‰§è¡Œï¼Œæ’ä»¶å¯ä»¥åœ¨è¿™ä¸ªé’©å­é‡Œæ‰§è¡Œå¯¹ä»£ç å—çš„ä¼˜åŒ–ï¼Œå›è°ƒå‚æ•°ï¼š<code>chunks</code></td></tr><tr><td>optimizeChunkAssets</td><td>AsyncSeriesHook</td><td>ä¼˜åŒ–ä»»ä½•ä»£ç å—èµ„æºï¼Œè¿™äº›èµ„æºå­˜æ”¾åœ¨ <code>compilation.assets</code> ä¸Šã€‚ä¸€ä¸ª Chunk æœ‰ä¸€ä¸ª files å±æ€§</td></tr><tr><td>optimizeAssets</td><td>AsyncSeriesHook</td><td>ä¼˜åŒ–æ‰€æœ‰å­˜æ”¾åœ¨ <code>compilation.assets</code> çš„æ‰€æœ‰èµ„æºã€‚å›è°ƒå‚æ•°ï¼š<code>assets</code></td></tr></tbody></table><h2 id="compiler-å’Œ-compilation-çš„åŒºåˆ«"><a aria-hidden="true" href="#compiler-å’Œ-compilation-çš„åŒºåˆ«"><span class="icon icon-link"></span></a>Compiler å’Œ Compilation çš„åŒºåˆ«</h2><p>Compiler ä»£è¡¨äº†æ•´ä¸ª Webpack ä»å¯åŠ¨åˆ°å…³é—­çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œ Compilation åªæ˜¯ä»£è¡¨äº†ä¸€æ¬¡æ–°çš„ç¼–è¯‘ï¼Œåªè¦æ–‡ä»¶æœ‰æ”¹åŠ¨ï¼Œ<code>compilation</code> å°±ä¼šè¢«é‡æ–°åˆ›å»ºã€‚</p><h2 id="å¸¸ç”¨-api"><a aria-hidden="true" href="#å¸¸ç”¨-api"><span class="icon icon-link"></span></a>å¸¸ç”¨ API</h2><p>æ’ä»¶å¯ä»¥ç”¨æ¥ä¿®æ”¹è¾“å‡ºæ–‡ä»¶ã€å¢åŠ è¾“å‡ºæ–‡ä»¶ã€ç”šè‡³å¯ä»¥æå‡ Webpack æ€§èƒ½ç­‰ç­‰ï¼Œæ€»ä¹‹æ’ä»¶é€šè¿‡è°ƒç”¨ Webpack æä¾›çš„ API èƒ½å®Œæˆå¾ˆå¤šäº‹æƒ…ã€‚ç”±äº Webpack æä¾›çš„ API éå¸¸å¤šï¼Œæœ‰å¾ˆå¤š API å¾ˆå°‘ç”¨å¾—ä¸Šï¼ŒåˆåŠ ä¸Šç¯‡å¹…æœ‰é™ï¼Œä¸‹é¢ä»‹ç»å¸¸ç”¨çš„ APIã€‚</p><h3 id="è¯»å–è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–"><a aria-hidden="true" href="#è¯»å–è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–"><span class="icon icon-link"></span></a>è¯»å–è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–</h3><p>æœ‰äº›æ’ä»¶å¯èƒ½éœ€è¦è¯»å– Webpack çš„å¤„ç†ç»“æœï¼Œä¾‹å¦‚è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–ï¼Œä»¥ä¾¿åšä¸‹ä¸€æ­¥å¤„ç†ã€‚åœ¨ emit äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä»£è¡¨æºæ–‡ä»¶çš„è½¬æ¢å’Œç»„è£…å·²ç»å®Œæˆï¼Œåœ¨è¿™é‡Œå¯ä»¥è¯»å–åˆ°æœ€ç»ˆå°†è¾“å‡ºçš„èµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–ï¼Œå¹¶ä¸”å¯ä»¥ä¿®æ”¹è¾“å‡ºèµ„æºçš„å†…å®¹ã€‚æ’ä»¶ä»£ç å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="class Plugin {
  apply(compiler) {
    comiler.plugin(&#x27;emit&#x27;, function(compilation, callback) {
      // compilation.chunks å­˜æ”¾æ‰€æœ‰ä»£ç å—ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„
      compilation.chunks.forEach(function (chunk) {
        // chunk ä»£è¡¨ä¸€ä¸ªä»£ç å—
        // ä»£ç å—ç”±å¤šä¸ªæ¨¡å—ç»„æˆï¼Œé€šè¿‡ chunk.forEachModule èƒ½è¯»å–ç»„æˆä»£ç å—çš„æ¯ä¸ªæ¨¡å—
        chunk.forEachModule(function(module) {
          // module ä»£è¡¨ä¸€ä¸ªæ¨¡å—
          // module.fileDependencies å­˜æ”¾å½“å‰æ¨¡å—çš„æ‰€æœ‰ä¾èµ–çš„æ–‡ä»¶è·¯å¾„ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„
          module.fileDependencies.forEach(function(filepath) {
            // ...
          })
        })

        // Webpack ä¼šæ ¹æ® Chunk å»ç”Ÿæˆè¾“å‡ºçš„æ–‡ä»¶èµ„æºï¼Œæ¯ä¸ª Chunk éƒ½å¯¹åº”ä¸€ä¸ªåŠå…¶ä»¥ä¸Šçš„è¾“å‡ºæ–‡ä»¶
        // ä¾‹å¦‚åœ¨ Chunk ä¸­åŒ…å«äº† CSS æ¨¡å—å¹¶ä¸”ä½¿ç”¨äº† ExtractTextPlugin æ—¶
        // è¯¥ Chunk å°±ä¼šç”Ÿæˆ .js å’Œ .css ä¸¤ä¸ªæ–‡ä»¶
        chunk.files.forEach(function(filename) {
          // compilation.assets å­˜æ”¾å½“å‰æ‰€æœ‰å³å°†è¾“å‡ºçš„èµ„æº
          // è°ƒç”¨ä¸€ä¸ªè¾“å‡ºèµ„æºçš„ source() æ–¹æ³•èƒ½è·å–åˆ°è¾“å‡ºèµ„æºçš„å†…å®¹
          let source = compilation.assets.[filename].source()
        });
      });

      // è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶ï¼Œè¦è®°å¾—è°ƒç”¨ callback é€šçŸ¥ Webpack æœ¬æ¬¡äº‹ä»¶ç›‘å¬å¤„ç†ç»“æŸ
      // å¦‚æœå¿˜è®°äº†è°ƒç”¨ callbackï¼ŒWebpack å°†ä¸€ç›´å¡åœ¨è¿™é‡Œè€Œä¸ä¼šå¾€åæ‰§è¡Œ
      callback();
    })
  }
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">Plugin</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    comiler</span><span class="token punctuation">.</span><span class="token method function property-access">plugin</span><span class="token punctuation">(</span><span class="token string">&#x27;emit&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token parameter punctuation">,</span><span class="token parameter"> callback</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// compilation.chunks å­˜æ”¾æ‰€æœ‰ä»£ç å—ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      compilation</span><span class="token punctuation">.</span><span class="token property-access">chunks</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// chunk ä»£è¡¨ä¸€ä¸ªä»£ç å—</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// ä»£ç å—ç”±å¤šä¸ªæ¨¡å—ç»„æˆï¼Œé€šè¿‡ chunk.forEachModule èƒ½è¯»å–ç»„æˆä»£ç å—çš„æ¯ä¸ªæ¨¡å—</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        chunk</span><span class="token punctuation">.</span><span class="token method function property-access">forEachModule</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// module ä»£è¡¨ä¸€ä¸ªæ¨¡å—</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// module.fileDependencies å­˜æ”¾å½“å‰æ¨¡å—çš„æ‰€æœ‰ä¾èµ–çš„æ–‡ä»¶è·¯å¾„ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          module</span><span class="token punctuation">.</span><span class="token property-access">fileDependencies</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">filepath</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// Webpack ä¼šæ ¹æ® Chunk å»ç”Ÿæˆè¾“å‡ºçš„æ–‡ä»¶èµ„æºï¼Œæ¯ä¸ª Chunk éƒ½å¯¹åº”ä¸€ä¸ªåŠå…¶ä»¥ä¸Šçš„è¾“å‡ºæ–‡ä»¶</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// ä¾‹å¦‚åœ¨ Chunk ä¸­åŒ…å«äº† CSS æ¨¡å—å¹¶ä¸”ä½¿ç”¨äº† ExtractTextPlugin æ—¶</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// è¯¥ Chunk å°±ä¼šç”Ÿæˆ .js å’Œ .css ä¸¤ä¸ªæ–‡ä»¶</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        chunk</span><span class="token punctuation">.</span><span class="token property-access">files</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// compilation.assets å­˜æ”¾å½“å‰æ‰€æœ‰å³å°†è¾“å‡ºçš„èµ„æº</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// è°ƒç”¨ä¸€ä¸ªè¾“å‡ºèµ„æºçš„ source() æ–¹æ³•èƒ½è·å–åˆ°è¾“å‡ºèµ„æºçš„å†…å®¹</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">let</span><span class="token plain"> source </span><span class="token operator">=</span><span class="token plain"> compilation</span><span class="token punctuation">.</span><span class="token property-access">assets</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token plain">filename</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶ï¼Œè¦è®°å¾—è°ƒç”¨ callback é€šçŸ¥ Webpack æœ¬æ¬¡äº‹ä»¶ç›‘å¬å¤„ç†ç»“æŸ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// å¦‚æœå¿˜è®°äº†è°ƒç”¨ callbackï¼ŒWebpack å°†ä¸€ç›´å¡åœ¨è¿™é‡Œè€Œä¸ä¼šå¾€åæ‰§è¡Œ</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="ç›‘å¬æ–‡ä»¶å˜åŒ–"><a aria-hidden="true" href="#ç›‘å¬æ–‡ä»¶å˜åŒ–"><span class="icon icon-link"></span></a>ç›‘å¬æ–‡ä»¶å˜åŒ–</h3><p>Webpack ä¼šä»é…ç½®çš„å…¥å£æ¨¡å—è§¦å‘ï¼Œä¾æ¬¡æ‰¾å‡ºæ‰€æœ‰çš„ä¾èµ–æ¨¡å—ï¼Œå½“å…¥å£æ¨¡å—æˆ–è€…å…¶ä¾èµ–çš„æ¨¡å—å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±ä¼šè§¦å‘ä¾æ¬¡æ–°çš„ Compilationã€‚</p><p>åœ¨å¼€å‘æ’ä»¶æ—¶ç»å¸¸éœ€è¦çŸ¥é“æ˜¯å“ªä¸ªæ–‡ä»¶å‘ç”Ÿå˜åŒ–å¯¼è‡´äº†æ–°çš„ Compilationï¼Œä¸ºæ­¤å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// å½“ä¾èµ–çš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ä¼šè§¦å‘ watch-run äº‹ä»¶
compiler.hooks.watchRun.tap(&#x27;MyPlugin&#x27;, (watching, callback) =&gt; {
  // è·å–å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶åˆ—è¡¨
  const changedFiles = watching.compiler.watchFileSystem.watcher.mtimes;
  // changedFiles æ ¼å¼ä¸ºé”®å€¼å¯¹ï¼Œé”®ä¸ºå‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶è·¯å¾„
  if (changedFiles[filePath] !== undefined) {
    // filePath å¯¹åº”çš„æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–
  }
  callback();
});
" data-status="copy"></button><div class="token-line"><span class="token comment">// å½“ä¾èµ–çš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ä¼šè§¦å‘ watch-run äº‹ä»¶</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">compiler</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">watchRun</span><span class="token punctuation">.</span><span class="token method function property-access">tap</span><span class="token punctuation">(</span><span class="token string">&#x27;MyPlugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">watching</span><span class="token parameter punctuation">,</span><span class="token parameter"> callback</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// è·å–å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶åˆ—è¡¨</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> changedFiles </span><span class="token operator">=</span><span class="token plain"> watching</span><span class="token punctuation">.</span><span class="token property-access">compiler</span><span class="token punctuation">.</span><span class="token property-access">watchFileSystem</span><span class="token punctuation">.</span><span class="token property-access">watcher</span><span class="token punctuation">.</span><span class="token property-access">mtimes</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// changedFiles æ ¼å¼ä¸ºé”®å€¼å¯¹ï¼Œé”®ä¸ºå‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶è·¯å¾„</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">changedFiles</span><span class="token punctuation">[</span><span class="token plain">filePath</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword nil">undefined</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// filePath å¯¹åº”çš„æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>é»˜è®¤æƒ…å†µä¸‹ Webpack åªä¼šç›‘è§†å…¥å£å’Œå…¶ä»–ä¾èµ–çš„æ¨¡å—æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹é¡¹ç›®å¯èƒ½éœ€è¦å¼•å…¥æ–°çš„æ–‡ä»¶ï¼Œä¾‹å¦‚å¼•å…¥ä¸€ä¸ª HTML æ–‡ä»¶ã€‚ç”±äº JavaScript æ–‡ä»¶ä¸ä¼šå»å¯¼å…¥ HTML æ–‡ä»¶ï¼ŒWebpack å°±ä¸ä¼šç›‘å¬ HTML æ–‡ä»¶çš„å˜åŒ–ï¼Œç¼–è¾‘ HTML æ–‡ä»¶æ—¶å°±ä¸ä¼šé‡æ–°è§¦å‘æ–°çš„ Compilationã€‚ä¸ºäº†ç›‘å¬ HTML æ–‡ä»¶çš„å˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ HTML æ–‡ä»¶åŠ å…¥åˆ°ä¾èµ–åˆ—è¡¨ä¸­ï¼Œä¸ºæ­¤å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="compiler.hooks.afterCompile.tap(&#x27;MyPlugin&#x27;, (compilation, callback) =&gt; {
  // æŠŠ HTML æ–‡ä»¶æ·»åŠ åˆ°æ–‡ä»¶ä¾èµ–åˆ—è¡¨ï¼Œå¥½è®© Webpack å»ç›‘å¬ HTML æ¨¡å—æ–‡ä»¶ï¼Œåœ¨ HTML æ¨¡ç‰ˆæ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°å¯åŠ¨ä¾æ¬¡ç¼–è¯‘
  compilation.fileDependencies.push(filePath);
  callback();
});
" data-status="copy"></button><div class="token-line"><span class="token plain">compiler</span><span class="token punctuation">.</span><span class="token property-access">hooks</span><span class="token punctuation">.</span><span class="token property-access">afterCompile</span><span class="token punctuation">.</span><span class="token method function property-access">tap</span><span class="token punctuation">(</span><span class="token string">&#x27;MyPlugin&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token parameter punctuation">,</span><span class="token parameter"> callback</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// æŠŠ HTML æ–‡ä»¶æ·»åŠ åˆ°æ–‡ä»¶ä¾èµ–åˆ—è¡¨ï¼Œå¥½è®© Webpack å»ç›‘å¬ HTML æ¨¡å—æ–‡ä»¶ï¼Œåœ¨ HTML æ¨¡ç‰ˆæ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°å¯åŠ¨ä¾æ¬¡ç¼–è¯‘</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  compilation</span><span class="token punctuation">.</span><span class="token property-access">fileDependencies</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token plain">filePath</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="ä¿®æ”¹è¾“å‡ºèµ„æº"><a aria-hidden="true" href="#ä¿®æ”¹è¾“å‡ºèµ„æº"><span class="icon icon-link"></span></a>ä¿®æ”¹è¾“å‡ºèµ„æº</h3><p>æœ‰äº›åœºæ™¯ä¸‹æ’ä»¶éœ€è¦ä¿®æ”¹ã€å¢åŠ ã€åˆ é™¤è¾“å‡ºçš„èµ„æºï¼Œè¦åšåˆ°è¿™ç‚¹éœ€è¦ç›‘å¬ <code>emit</code> äº‹ä»¶ï¼Œå› ä¸ºå‘ç”Ÿ <code>emit</code> äº‹ä»¶æ—¶æ‰€æœ‰æ¨¡å—çš„è½¬æ¢å’Œä»£ç å—å¯¹åº”çš„æ–‡ä»¶å·²ç»ç”Ÿæˆå¥½ï¼Œéœ€è¦è¾“å‡ºçš„èµ„æºå³å°†è¾“å‡ºï¼Œå› æ­¤ <code>emit</code> äº‹ä»¶æ˜¯ä¿®æ”¹ Webpack è¾“å‡ºèµ„æºçš„æœ€åæ—¶æœºã€‚</p><p>æ‰€æœ‰éœ€è¦è¾“å‡ºçš„èµ„æºä¼šå­˜æ”¾åœ¨ <code>compilation.assets</code> ä¸­ï¼Œ<code>compilation.assets</code> æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®ä¸ºéœ€è¦è¾“å‡ºçš„æ–‡ä»¶åç§°ï¼Œå€¼ä¸ºæ–‡ä»¶å¯¹åº”çš„å†…å®¹ã€‚</p><p>è®¾ç½® <code>compilation.assets</code> çš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// è®¾ç½®åç§°ä¸º fileName çš„è¾“å‡ºèµ„æº
compilation.assets[fileName] = {
  // è¿”å›æ–‡ä»¶å†…å®¹
  source: () =&gt; {
    // fileContent æ—¢å¯ä»¥æ˜¯ä»£è¡¨æ–‡æœ¬æ–‡ä»¶çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»£è¡¨äºŒè¿›åˆ¶æ–‡ä»¶çš„ Buffer
    return fileContent;
  },
  // è¿”å›æ–‡ä»¶å¤§å°
  size: () =&gt; {
    return Buffer.byteLength(fileContent, &#x27;utf8&#x27;);
  },
};
" data-status="copy"></button><div class="token-line"><span class="token comment">// è®¾ç½®åç§°ä¸º fileName çš„è¾“å‡ºèµ„æº</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">compilation</span><span class="token punctuation">.</span><span class="token property-access">assets</span><span class="token punctuation">[</span><span class="token plain">fileName</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// è¿”å›æ–‡ä»¶å†…å®¹</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function-variable function">source</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// fileContent æ—¢å¯ä»¥æ˜¯ä»£è¡¨æ–‡æœ¬æ–‡ä»¶çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»£è¡¨äºŒè¿›åˆ¶æ–‡ä»¶çš„ Buffer</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> fileContent</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// è¿”å›æ–‡ä»¶å¤§å°</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function-variable function">size</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token maybe-class-name">Buffer</span><span class="token punctuation">.</span><span class="token method function property-access">byteLength</span><span class="token punctuation">(</span><span class="token plain">fileContent</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;utf8&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="åˆ¤æ–­-webpack-ä½¿ç”¨äº†å“ªäº›æ’ä»¶"><a aria-hidden="true" href="#åˆ¤æ–­-webpack-ä½¿ç”¨äº†å“ªäº›æ’ä»¶"><span class="icon icon-link"></span></a>åˆ¤æ–­ Webpack ä½¿ç”¨äº†å“ªäº›æ’ä»¶</h3><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// åˆ¤æ–­å½“å‰é…ç½®ä½¿ç”¨äº† ExtractTextPlugin
// compiler å‚æ•°å³ä¸º Webpack åœ¨ apply(compiler) ä¸­ä¼ å…¥çš„å‚æ•°
function hasExtractTextPlugin(compiler) {
  // å½“å‰é…ç½®æ‰€æœ‰ä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨
  const plugins = compiler.options.plugins;
  // å» plugins ä¸­å¯»æ‰¾æœ‰æ²¡æœ‰ ExtractTextPlugin çš„å®ä¾‹
  return plugins.find(plugin =&gt; plugin.__proto__.constructor === ExtractTextPlugin) != null;
}
" data-status="copy"></button><div class="token-line"><span class="token comment">// åˆ¤æ–­å½“å‰é…ç½®ä½¿ç”¨äº† ExtractTextPlugin</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// compiler å‚æ•°å³ä¸º Webpack åœ¨ apply(compiler) ä¸­ä¼ å…¥çš„å‚æ•°</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">hasExtractTextPlugin</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// å½“å‰é…ç½®æ‰€æœ‰ä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> plugins </span><span class="token operator">=</span><span class="token plain"> compiler</span><span class="token punctuation">.</span><span class="token property-access">options</span><span class="token punctuation">.</span><span class="token property-access">plugins</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// å» plugins ä¸­å¯»æ‰¾æœ‰æ²¡æœ‰ ExtractTextPlugin çš„å®ä¾‹</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> plugins</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token parameter">plugin</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> plugin</span><span class="token punctuation">.</span><span class="token class-name">__proto__</span><span class="token punctuation">.</span><span class="token property-access">constructor</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token maybe-class-name">ExtractTextPlugin</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="æ–‡ä»¶å†™å…¥"><a aria-hidden="true" href="#æ–‡ä»¶å†™å…¥"><span class="icon icon-link"></span></a>æ–‡ä»¶å†™å…¥</h3><p>Compilation ä¸Šçš„ assets å¯ä»¥ç”¨äºæ–‡ä»¶å†™å…¥</p><ul><li>å¯å°† zip èµ„æºåŒ…è®¾ç½®ä¸º <code>compilation.assets</code> å¯¹è±¡ä¸Š</li></ul><p>æ–‡ä»¶å†™å…¥éœ€è¦ä½¿ç”¨ <a href="https://www.npmjs.com/package/webpack-sources" target="_blank" rel="noopener noreferrer">webpack-sources<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const { RawSource } = require(&#x27;webpack-sources&#x27;);

module.exports = class DemoPlugin {
  constructor(options) {
    this.options = options;
  }

  apply(compiler) {
    const { name } = this.options;
    compilation.plugin(&#x27;emit&#x27;, (compilation, cb) =&gt; {
      compilation.assets[name] = new RawSource(&#x27;demo&#x27;);
      cb();
    });
  }
};
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token maybe-class-name">RawSource</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;webpack-sources&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">DemoPlugin</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">options</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> options</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> name </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">options</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    compilation</span><span class="token punctuation">.</span><span class="token method function property-access">plugin</span><span class="token punctuation">(</span><span class="token string">&#x27;emit&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token parameter punctuation">,</span><span class="token parameter"> cb</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      compilation</span><span class="token punctuation">.</span><span class="token property-access">assets</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">RawSource</span><span class="token punctuation">(</span><span class="token string">&#x27;demo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="å¼‚å¸¸æˆ–è­¦å‘Šå¤„ç†"><a aria-hidden="true" href="#å¼‚å¸¸æˆ–è­¦å‘Šå¤„ç†"><span class="icon icon-link"></span></a>å¼‚å¸¸æˆ–è­¦å‘Šå¤„ç†</h3><p>åšä¸€ä¸ªå®éªŒï¼Œå¦‚æœä½ åœ¨ <code>apply</code> å‡½æ•°å†…æ’å…¥ <code>throw new Error(&quot;message&quot;)</code>ï¼Œç»ˆç«¯ä¼šæ‰“å°å‡º <code>Unhandled rejection Error: Message</code>ã€‚ç„¶å Webpack ä¸­æ–­æ‰§è¡Œã€‚ä¸ºäº†ä¸å½±å“ Webpack çš„æ‰§è¡Œï¼Œè¦åœ¨ç¼–è¯‘æœŸé—´å‘ç”¨æˆ·å‘å‡ºè­¦å‘Šæˆ–é”™è¯¯æ¶ˆæ¯ï¼Œåˆ™åº”ä½¿ç”¨ <code>compilation.warnings</code> å’Œ <code>compilation.errors</code>ã€‚</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="compilation.warnings.push(&#x27;warning&#x27;);

compilation.errors.push(&#x27;error&#x27;);
" data-status="copy"></button><div class="token-line"><span class="token plain">compilation</span><span class="token punctuation">.</span><span class="token property-access">warnings</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token string">&#x27;warning&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">compilation</span><span class="token punctuation">.</span><span class="token property-access">errors</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token string">&#x27;error&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="æ’ä»¶æ‰©å±•ï¼šç¼–å†™æ’ä»¶çš„æ’ä»¶"><a aria-hidden="true" href="#æ’ä»¶æ‰©å±•ï¼šç¼–å†™æ’ä»¶çš„æ’ä»¶"><span class="icon icon-link"></span></a>æ’ä»¶æ‰©å±•ï¼šç¼–å†™æ’ä»¶çš„æ’ä»¶</h3><p>æ’ä»¶è‡ªèº«ä¹Ÿå¯ä»¥é€šè¿‡æš´éœ² hooks çš„æ–¹å¼è¿›è¡Œè‡ªèº«æ‰©å±•ï¼Œä»¥ <code>html-webpack-plugin</code> ä¸ºä¾‹ï¼š</p><ul><li><code>html-webpack-plugin-alter-chunks</code>ï¼ˆSyncï¼‰</li><li><code>html-webpack-plugin-before-html-generation</code>ï¼ˆAsyncï¼‰</li><li><code>html-webpack-plugin-alter-asset-tags</code>ï¼ˆAsyncï¼‰</li><li><code>html-webpack-plugin-after-html-processing</code>ï¼ˆAsyncï¼‰</li><li><code>html-webpack-plugin-after-emit</code>ï¼ˆAsyncï¼‰</li></ul><h2 id="å¼€å‘è°ƒè¯•"><a aria-hidden="true" href="#å¼€å‘è°ƒè¯•"><span class="icon icon-link"></span></a>å¼€å‘è°ƒè¯•</h2><ol><li>åœ¨å½“å‰ Webpack é¡¹ç›®å·¥ç¨‹æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œæ‰§è¡Œå‘½ä»¤è¡Œï¼š</li></ol><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="node --inspect-brk ./node_modules/webpack/bin/webpack.js --inline --progress
" data-status="copy"></button><div class="token-line"><span class="token plain">node --inspect-brk ./node_modules/webpack/bin/webpack.js --inline --progress</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>å…¶ä¸­å‚æ•° <code>--inspect-brk</code> å°±æ˜¯ä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨ Nodeï¼š</p><p>ç»ˆç«¯ä¼šè¾“å‡ºï¼š</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Debugger listening on ws://127.0.0.1:9229/1018c03f-7473-4d60-b62c-949a6404c81d
For help, see: https://nodejs.org/en/docs/inspector
" data-status="copy"></button><div class="token-line"><span class="token plain">Debugger listening on ws://127.0.0.1:9229/1018c03f-7473-4d60-b62c-949a6404c81d</span></div><div class="token-line"><span class="token plain">For help, see: https://nodejs.org/en/docs/inspector</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ol start="2"><li>Chrome è¾“å…¥ <code>chrome://inspect/#devices</code></li></ol></div><img alt="æµè§ˆå™¨è°ƒè¯•æ¨¡å¼" src="/webpack-guidebook/static/chrome-devices-inspect.5ddd130d.jpeg" width="640"/><div class="markdown"><ol start="3"><li>ç„¶åç‚¹å‡» Chrome è°ƒè¯•å™¨ä¸­çš„ <code>ç»§ç»­æ‰§è¡Œ</code>ï¼Œæ–­ç”µå°±æç•™åœ¨æˆ‘ä»¬è®¾ç½®åœ¨æ’ä»¶ä¸­çš„ bugger æ–­ç‚¹äº†</li></ol></div><img alt="ä»£ç æ–­ç‚¹" src="/webpack-guidebook/static/chrome-debugger.e33a45ea.jpeg" width="640"/><div class="markdown"><hr/><p><strong>å‚è€ƒèµ„æ–™ï¼š</strong></p><ul><li><a href="https://juejin.im/post/5ec169786fb9a043721b46ad" target="_blank" rel="noopener noreferrer">ğŸ“ æ­ç§˜ Webpack æ’ä»¶å·¥ä½œæµç¨‹å’ŒåŸç†ï¼ˆ2020-05-18ï¼‰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://juejin.im/post/5ec16a2e5188256d841a53d0" target="_blank" rel="noopener noreferrer">ğŸ“ å®ç°è‡ªå®šä¹‰ Webpack æ’ä»¶è¯¦è§£ï¼ˆ2020-05-19ï¼‰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="http://wushaobin.top/2019/03/15/webpackPlugin/" target="_blank" rel="noopener noreferrer">ğŸ“ Webpack å­¦ä¹  â€” Pluginï¼ˆ2019-03-15ï¼‰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://zhuanlan.zhihu.com/p/26955349" target="_blank" rel="noopener noreferrer">ğŸ“ æµ…æ Webpack æ’ä»¶åŒ–è®¾è®¡ï¼ˆ2017-05-18ï¼‰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/Webpack-Guidebook/edit/master/docs/principle-analysis/implementation-principle/plugin.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/18/2020, 10:19:07 AM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/webpack-guidebook/umi.js"></script>
    <script src="/webpack-guidebook/docs__principle-analysis__implementation-principle__plugin.md.js"></script>
  </body>
</html>
