<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/webpack-guidebook/umi.331878c1.css" />
    <script>
      window.routerBase = "/webpack-guidebook/";
    </script>
    <script>
      //! umi version: 3.5.20
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.indexOf(e) > -1 ? e : r[0]
        );
      })();
    </script>
    <title>分割打包 Bundle Spliting - Webpack Guidebook</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/best-practice/optimization/bundle-spliting" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/webpack-guidebook-favicon.svg&#x27;)" href="/webpack-guidebook//">Webpack Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/webpack-guidebook//basic">基本综述</a></span><span><a href="/webpack-guidebook//infra">架构原理</a></span><span><a aria-current="page" class="active" href="/webpack-guidebook//best-practice">最佳实践</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/webpack-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/webpack-guidebook-favicon.svg&#x27;)" href="/webpack-guidebook//"></a><h1>Webpack Guidebook</h1><p>Webpack 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/webpack-guidebook//basic">基本综述</a></li><li><a href="/webpack-guidebook//infra">架构原理</a></li><li><a aria-current="page" class="active" href="/webpack-guidebook//best-practice">最佳实践</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/webpack-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a target="_blank" rel="noopener noreferrer">实战应用</a><ul><li><a href="/webpack-guidebook//best-practice/practical-application/composing-webpack-configuration"><span>组合配置</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-style"><span>加载样式</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-images"><span>加载图片</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-fonts"><span>加载字体</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/loading-javascript"><span>加载脚本</span></a></li><li><a href="/webpack-guidebook//best-practice/practical-application/environment-variables"><span>环境变量</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">构建优化</a><ul><li><a href="/webpack-guidebook//best-practice/optimization/build-analyze"><span>构建分析</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/exclude-build-target"><span>缩小构建目标</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/precompile"><span>预编译资源模块</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/build-cache-strategy"><span>构建缓存策略</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/multi-process"><span>多进程/多线程优化</span></a></li><li><a aria-current="page" class="active" href="/webpack-guidebook//best-practice/optimization/bundle-spliting"><span>分割打包 Bundle Spliting</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/code-splitting"><span>代码拆分 Code Spliting</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/minifying"><span>压缩代码</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/dynamic-polyfill"><span>动态 Ployfill</span></a></li><li><a href="/webpack-guidebook//best-practice/optimization/collection"><span>构建优化总结</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">扩展资料</a><ul><li><a href="/webpack-guidebook//best-practice/extensions/overview"><span>推荐资料</span></a></li><li><a href="/webpack-guidebook//best-practice/extensions/loaders"><span>加载器合集</span></a></li><li><a href="/webpack-guidebook//best-practice/extensions/plugins"><span>插件合集</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="分割打包的思想" data-depth="2"><a href="/webpack-guidebook//best-practice/optimization/bundle-spliting#分割打包的思想"><span>分割打包的思想</span></a></li><li title="生成算法" data-depth="3"><a href="/webpack-guidebook//best-practice/optimization/bundle-spliting#生成算法"><span>生成算法</span></a></li><li title="SplitChunksPlugin" data-depth="2"><a href="/webpack-guidebook//best-practice/optimization/bundle-spliting#splitchunksplugin"><span>SplitChunksPlugin</span></a></li><li title="CommonsChunkPlugin" data-depth="2"><a href="/webpack-guidebook//best-practice/optimization/bundle-spliting#commonschunkplugin"><span>CommonsChunkPlugin</span></a></li><li title="激进合并 HTTP/2" data-depth="2"><a href="/webpack-guidebook//best-practice/optimization/bundle-spliting#激进合并-http2"><span>激进合并 HTTP/2</span></a></li><li title="参考资料" data-depth="2"><a href="/webpack-guidebook//best-practice/optimization/bundle-spliting#参考资料"><span>参考资料</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="分割打包-bundle-spliting"><a aria-hidden="true" tabindex="-1" href="/webpack-guidebook//best-practice/optimization/bundle-spliting#分割打包-bundle-spliting"><span class="icon icon-link"></span></a>分割打包 Bundle Spliting</h1><p>目前，生产环境下的打包结果是单个 JavaScript 文件。如果更改了代码，则客户端也必须重新下载整个包，包括一些外部依赖包。</p><p>最好的结果是只下载更改的部分。如果外部依赖包发生更改，则客户端应仅获取依赖包。对于应用本身的代码也是如此。在 Webpack4 我们可以使用 <code>optimization.splitChunks.cacheGroups</code> 来进行 <code>分割打包</code>。</p><p>Webpack 提供了提取公共代码的分包插件，根据版本不同使用不同的插件：</p><ul><li>Webpack 4+：SplitChunksPlugin</li><li>Webpack 3：CommonsChunkPlugin</li></ul><blockquote><p>要正确使打包结果无效，必须将哈希附加到生成的 bundle 中。</p></blockquote><h2 id="分割打包的思想"><a aria-hidden="true" tabindex="-1" href="/webpack-guidebook//best-practice/optimization/bundle-spliting#分割打包的思想"><span class="icon icon-link"></span></a>分割打包的思想</h2><p>通过拆分打包，您可以将外包依赖项单独打包，并从客户端级别缓存中受益。执行了该过程，应用程序的整个大小依然保持不变。尽管需要执行的请求越多，会产生轻微的开销，但缓存的好处弥补了这一成本。</p><p>一个模块化的 JS 文件就是一个模块，若干个 JS 模块会打包成一个总的 JS 文件，这个 JS 文件称作 Bundle。但如果是多页面应用，往往会安排为一个 HTML 对应一个 Bundle，那么两个 HTML 的 Bundle 之间重复的模块就是重复代码。此时我们会把这两个 Bundle 重复的模块抽出来，称为 Common Chunk，余下的两部分直接称作两个 Chunk。即此时一共有 3 个 Chunk，但依然只有两个 Bundle。</p><p><strong>Chunk 和 Bundle 的关系</strong></p><ul><li>Chunk（块）：指若干个 JS Module 的集合</li><li>Bundle：形式上是块的集合，意义是代表一个可以运行的整体</li></ul><p>单页面应用中异步加载，或者单纯想分离出不变的第三方库，均可采用该手段进行优化。</p><p>Webpack 处理三种类型的块：</p><ol><li><strong>入口块</strong>：入口块包含 Webpack 运行时和它随后加载的模块。</li><li><strong>正常块</strong>：正常块不包含 Webpack 运行时。相反，这些可以在应用程序运行时动态加载，Webpack 为这些块生成合适的包装器（例如 JSONP）。</li><li><strong>初始块</strong>：初始块是正常的块，计入应用程序的初始加载时间。作为用户，您不必关心这些。这是入口块和正常块之间的重要的分割点。</li></ol><h3 id="生成算法"><a aria-hidden="true" tabindex="-1" href="/webpack-guidebook//best-practice/optimization/bundle-spliting#生成算法"><span class="icon icon-link"></span></a>生成算法</h3><ol><li>Webpack 先将 entry 中对应的 module 都生成一个新的 Chunk</li><li>遍历 module 的依赖列表，将依赖的 module 也加入到 Chunk 中</li><li>如果一个依赖 module 是动态引入的模块，那么就会根据这个 module 创建一个新的 Chunk，继续遍历依赖</li><li>重复上面的过程，直至得到所有的 Chunks</li></ol><h2 id="splitchunksplugin"><a aria-hidden="true" tabindex="-1" href="/webpack-guidebook//best-practice/optimization/bundle-spliting#splitchunksplugin"><span class="icon icon-link"></span></a>SplitChunksPlugin</h2><p>升级了 Webpack4 之后，<code>mode: production</code> 模式下，SplitChunksPlugin 插件是默认被启用的，默认配置如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">optimization</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  splitChunks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// async -&gt; 针对异步加载的 Chunk 做切割</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// initial -&gt; 针对初始 Chunk</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// all -&gt; 针对所有 Chunk</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    chunks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;async&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 切割完要生成的新 Chunk 要大于该值，否则不生成新 Chunk</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    minSize</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">30000</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 共享该 module 的最小 Chunk 数</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    minChunks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 最多异步加载请求该模块</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    maxAsyncRequests</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 初始化的时候最多请求该模块</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    maxInitialRequests</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ：名字中间的间隔符</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    automaticNameDelimiter</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;~&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// Chunk 的名字，如果设为 `true`，会根据被提取的 Chunk 自动生成</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//（要切割成的每个新 Chunk 就是一个 Cache Group）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    cacheGroups</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      vendors</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// 和 CommonsChunkPlugin 里的 minChunks 非常像，用来决定提取哪些模块</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// 可以接受字符串，正则表达式，或者函数，函数的一个参数是 module，第二个参数为引用这个 module 的 chunk（数组）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex regex-delimiter">/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// 优先级高的 Chunk 为被优先选择，优先级一样的话，`size` 大的优先被选择</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          priority</span><span class="token operator">:</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">10</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    	</span><span class="token keyword module">default</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          minChunks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          priority</span><span class="token operator">:</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">//当 module 未变时，是否可以使用之前的 Chunk</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          reuseExistingChunk</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><h2 id="commonschunkplugin"><a aria-hidden="true" tabindex="-1" href="/webpack-guidebook//best-practice/optimization/bundle-spliting#commonschunkplugin"><span class="icon icon-link"></span></a>CommonsChunkPlugin</h2><p>每个 CommonsChunkPlugin 实例都会生成一个新的 Chunk，在这个 Chunk 中包含了被提取的代码，在使用的过程中必须指定 name 属性，以告诉插件新生成的 Chunk 的名称。其中 chunks 属性指明从哪些已有的 Chunk 中提取，如果不填该属性，则默认会从所有已知的 Chunk 中提取。</p><p>Chunk 时一系列文件的集合，在一个 Chunk 中会包含这个 Chunk 的入口文件和该入口文件依赖的文件。</p><p>在通过以上配置输出的 common Chunk 中会包含所有页面都依赖的基础运行库 react、react-dom，为了将基础运行库从 common 中抽离到 base 中，还需要做一些处理。</p><p>首先需要配置一个 Chunk，在这个 Chunk 中只依赖所有页面都依赖的基础库及所有页面都使用的样式，为此需要在项目中写一 个 文件 <code>base.js</code> 来描述 base Chunk 所依赖的模块，文件 的内容如下:</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// 所有页面都依赖的基础库</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;react-dom&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 所有页面都使用的样式</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;./base.css&#x27;</span><span class="token punctuation">;</span></div></pre></div><p>修改 Webpack 的配置。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    base</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;./base.js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p>为了从 common 中提取出 base 也包含的部分，还需要配置一个 CommonsChunkPlugin。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 从 common 和 base 两个现成的 Chunk 中提取公共部分</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  chunks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;common&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;base&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 将公共部分放到 base 中</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;base&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>由于 common 和 base 的公共部分就是 base 目前已包含的部分，所以这样配置后 common 将会变小，而 base 将保持不变。</p><p>如此配置，需要在其 HTML 中按照顺序引入文件。</p><p>采用以上方法后可能会出现 common.js 中没有代码的情况，原因是去掉基础运行库后，很难再找到所有页面都会用上的模块。</p><p><strong>解决方案：</strong></p><ul><li>CommonsChunkPlugin 提供了一个选项 minChunks，表示文件要被提取出来时需要在指定的 Chunks 中出现的最小次数。假如 <code>minChunks=2</code>、 <code>chunks=[&#x27;a&#x27;, &#x27;吧&#x27;，&#x27;c&#x27;，&#x27;吁&#x27;]</code>，则任何一个文件只要在 <code>[&#x27;a&#x27;，&#x27;币&#x27;，&#x27;c&#x27;，&#x27;d&#x27;]</code> 中两个 以上的 Chunk 中都出现过，这个文件就会被提取出来。我们可以根据自己的需求去调整 minChunks 的值， minChunks 越小，被提取到 <code>common.js</code> 中的文件就会越多 ，但这也会导致部分页面加载的不相关的资源越多：minChunks 越大，被提取到 <code>common.js</code> 中的文件就会越少，但这会导致 <code>common.js</code> 变小、效果变弱。</li><li>根据各个页面之间的相关性选取其中的部分页面时，可用 CommonsChunkPlugin 提取这部分被选出的页面的公共部分，而不是提取所有页面的公共部分，而且这样的操作可以叠加多次。这样做的效果会很好，但缺点是配置复杂， 需要根据页面之间的关系去思考如何配置，该方法并不通用 。</li></ul><h2 id="激进合并-http2"><a aria-hidden="true" tabindex="-1" href="/webpack-guidebook//best-practice/optimization/bundle-spliting#激进合并-http2"><span class="icon icon-link"></span></a>激进合并 HTTP/2</h2><p>Webpack 通过两个插件提供对生成的块的更多控制：AggressiveSplittingPlugin 和 AggressiveMergingPlugin。</p><ul><li>前者可以产生更多的小块 bundles，但同时会增加客户端的请求数量（HTTP2 采取多路复用，可以很好适应）</li><li>后者相反，产生更少的 bundles</li></ul><p>以下是一种更激进的分割打包方式：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  plugins</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">webpack</span><span class="token class-name punctuation">.</span><span class="token class-name">optimize</span><span class="token class-name punctuation">.</span><span class="token class-name">AggressiveSplittingPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        minSize</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        maxSize</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">30000</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><p>如果你分成多个小的块，对于客户端缓存来说是比较有利的；但是，在 HTTP/1 环境中还会有额外的请求开销。目前，由于 <code>HtmlWebpackPlugin</code> 中的 BUG，如果启用该插件，这个方法不会起作用。</p><p>使用这项技术的应用不再输出包含在 HTML 文件中的单独文件，相反，它输出多个需要被加载的块（chunk），应用就能使用多个 <code>&lt;script&gt;</code> 标签（并行）加载每个块。就像这样：</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">1ea296932eacbe248905.js</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token script"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">0b3a074667143853404c.js</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token script"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">0dd8c061aff2a2791815.js</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token script"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">191b812fa5f7504151f7.js</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token script"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">08702f45497539ef6ea6.js</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token script"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span></div></pre></div><p>Webpack 按时间先后顺序输出这些块。最旧的文件先执行，最新的在最后。浏览器可以先执行已被缓存的块，同时加载最新的文件，旧文件更可能已经被缓存。</p><p>当 HTML 文件被请求时，HTTP/2 服务端推送可以将这些块推送给客户端。也是因为旧文件更可能已经被缓存，最好能先推送最新的文件。如果已经有缓存，客户端可以取消服务端的推送，但这需要一次往返。</p><p>Webpack 将代码分离用于 <strong>按需加载</strong>，可以处理并行请求。</p><p>这个激进的插件还能够以相反的方式工作，允许您将小的块组合成更大的块：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  plugins</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">AggressiveMergingPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      minSizeReduce</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      moveToParents</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><h2 id="参考资料"><a aria-hidden="true" tabindex="-1" href="/webpack-guidebook//best-practice/optimization/bundle-spliting#参考资料"><span class="icon icon-link"></span></a>参考资料</h2><ul><li><a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/42523436/what-are-module-chunk-and-bundle-in-webpack">what-are-module-chunk-and-bundle-in-webpack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://blog.csdn.net/weixin_34273481/article/details/87956102">Webpack &amp; HTTP/2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a target="_blank" rel="noopener noreferrer" href="https://medium.com/webpack/webpack-http-2-7083ec3f3ce6">激进合并<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/Webpack-Guidebook/edit/master/docs/best-practice/optimization/bundle-spliting.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">10/27/2021 18:51:11</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/webpack-guidebook/umi.a58570f0.js"></script>
  </body>
</html>
