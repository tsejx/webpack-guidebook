---
nav:
  title: åŸºæœ¬ç»¼è¿°
  order: 1
group:
  title: åŸºæœ¬æ¦‚å¿µ
  order: 1
title: Grunt
order: 3
---

# Grunt

Grunt æ˜¯åŸºäº Node.js çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®é™…ä¸Šå®ƒä¹Ÿæ˜¯ä¸€ä¸ª **ä»»åŠ¡è¿è¡Œå™¨**ï¼ˆTask Runnerï¼‰ï¼Œå¯ç”¨äºè‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•ã€ç”Ÿæˆæ–‡æ¡£çš„é¡¹ç›®å·¥å…·ã€‚

Grunt é€šè¿‡ `grunt` å¯¹è±¡æš´éœ²æ‰€æœ‰æ–¹æ³•å’Œå±æ€§ï¼Œå¹¶å°†æ­¤å¯¹è±¡èµ‹äºˆ `module.exports` å‡½æ•°ï¼Œè¿™äº›æ–¹æ³•å’Œå±æ€§éƒ½å°†ä¼ é€’åˆ°ä½ çš„ Gruntfileã€Grunt æ’ä»¶æˆ–è€… `task` æ–‡ä»¶ä¸­ã€‚

æ‰€æœ‰çš„æ–¹æ³•å‡ ä¹éƒ½æ˜¯åœ¨åˆ«å¤„å®šä¹‰çš„ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œä¹Ÿåœ¨ `grunt` å¯¹è±¡ä¸­åšäº†å®šä¹‰ã€‚è¯¦ç»†çš„è§£é‡Šå’Œæ¡ˆä¾‹è¯·å‚é˜…å„ä¸ª [API](https://www.gruntjs.net/api/grunt) å•ç‹¬çš„æ–‡æ¡£ã€‚

## Gruntfile

`Gruntfile.js` æˆ– `Gruntfile.coffee` æ–‡ä»¶æ˜¯æœ‰æ•ˆçš„ JavaScript æˆ– CoffeeScript æ–‡ä»¶ï¼Œåº”å½“æ”¾åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œå’Œ `package.json` æ–‡ä»¶åœ¨åŒä¸€ç›®å½•å±‚çº§ï¼Œå¹¶å’Œé¡¹ç›®æºç ä¸€èµ·åŠ å…¥æºç ç®¡ç†å™¨ã€‚

Gruntfile ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†æ„æˆï¼š

- `"wrapper"` å‡½æ•°
- é¡¹ç›®ä¸ä»»åŠ¡é…ç½®
- åŠ è½½ Grunt æ’ä»¶å’Œä»»åŠ¡
- è‡ªå®šä¹‰ä»»åŠ¡

### æ–‡ä»¶æ¡ˆä¾‹

åœ¨ä¸‹é¢åˆ—å‡ºçš„è¿™ä¸ª Gruntfile ä¸­ï¼Œ`package.json` æ–‡ä»¶ä¸­çš„é¡¹ç›®å…ƒæ•°æ®ï¼ˆmetadataï¼‰è¢«å¯¼å…¥åˆ° Grunt é…ç½®ä¸­ï¼Œ `grunt-contrib-uglify` æ’ä»¶ä¸­çš„ `uglify` ä»»åŠ¡ï¼ˆtaskï¼‰è¢«é…ç½®ä¸ºå‹ç¼©ï¼ˆminifyï¼‰æºç æ–‡ä»¶å¹¶ä¾æ®ä¸Šè¿°å…ƒæ•°æ®åŠ¨æ€ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å¤´æ³¨é‡Šã€‚å½“åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ `grunt` å‘½ä»¤æ—¶ï¼Œ`uglify` ä»»åŠ¡å°†è¢«é»˜è®¤æ‰§è¡Œã€‚

```js
module.exports = function(grunt) {
  // é¡¹ç›®åˆå§‹åŒ–é…ç½®
  grunt.initConfig({
    pkg: grunt.file.readJSON('package.json'),
    uglify: {
      options: {
        banner: '/*! <%= pkg.name %> <%= grunt.template.today("yyyy-mm-dd") %> */\n',
      },
      build: {
        src: 'src/<%= pkg.name %>.js',
        dest: 'build/<%= pkg.name %>.min.js',
      },
    },
  });

  // åŠ è½½åŒ…å« "uglify" ä»»åŠ¡çš„æ’ä»¶ã€‚
  grunt.loadNpmTasks('grunt-contrib-uglify');

  // é»˜è®¤è¢«æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚
  grunt.registerTask('default', ['uglify']);
};
```

### åŒ…è£…å‡½æ•°

æ¯ä¸€ä»½ Gruntfile ï¼ˆå’Œ Grunt æ’ä»¶ï¼‰éƒ½éµå¾ªåŒæ ·çš„æ ¼å¼ï¼Œä½ æ‰€ä¹¦å†™çš„ Grunt ä»£ç å¿…é¡»æ”¾åœ¨æ­¤å‡½æ•°å†…ï¼š

```js
module.exports = function(grunt) {
  // Do grunt-related things in here
};
```

### é¡¹ç›®å’Œä»»åŠ¡é…ç½®

å¤§éƒ¨åˆ†çš„ Grunt ä»»åŠ¡éƒ½ä¾èµ–æŸäº›é…ç½®æ•°æ®ï¼Œè¿™äº›æ•°æ®è¢«å®šä¹‰åœ¨ä¸€ä¸ª `object` å†…ï¼Œå¹¶ä¼ é€’ç»™ `grunt.initConfig` æ–¹æ³•ã€‚

åœ¨ä¸‹é¢çš„æ¡ˆä¾‹ä¸­ï¼Œ`grunt.file.readJSON('package.json')` å°†å­˜å‚¨åœ¨ `package.json` æ–‡ä»¶ä¸­çš„ JSON å…ƒæ•°æ®å¼•å…¥åˆ° `grunt config` ä¸­ã€‚ ç”±äº `<% %>` æ¨¡æ¿å­—ç¬¦ä¸²å¯ä»¥å¼•ç”¨ä»»æ„çš„é…ç½®å±æ€§ï¼Œå› æ­¤å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥æŒ‡å®šè¯¸å¦‚æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶åˆ—è¡¨ç±»å‹çš„é…ç½®æ•°æ®ï¼Œä»è€Œå‡å°‘ä¸€äº›é‡å¤çš„å·¥ä½œã€‚

ä½ å¯ä»¥åœ¨è¿™ä¸ªé…ç½®å¯¹è±¡ä¸­ï¼ˆä¼ é€’ç»™ `initConfig()`æ–¹æ³•çš„å¯¹è±¡ï¼‰å­˜å‚¨ä»»æ„çš„æ•°æ®ï¼Œåªè¦å®ƒä¸ä¸ä½ ä»»åŠ¡é…ç½®æ‰€éœ€çš„å±æ€§å†²çªï¼Œå¦åˆ™ä¼šè¢«å¿½ç•¥ã€‚æ­¤å¤–ï¼Œç”±äºè¿™æœ¬èº«å°±æ˜¯ JavaScriptï¼Œä½ ä¸ä»…é™äºä½¿ç”¨ JSONï¼›ä½ å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ä»»æ„çš„æœ‰æ•ˆçš„ JS ä»£ç ã€‚å¦‚æœæœ‰å¿…è¦ï¼Œä½ ç”šè‡³å¯ä»¥ä»¥ç¼–ç¨‹çš„æ–¹å¼ç”Ÿæˆé…ç½®ã€‚

ä¸å¤§å¤šæ•° task ä¸€æ ·ï¼Œ`grunt-contrib-uglify` æ’ä»¶ä¸­çš„ `uglify` ä»»åŠ¡è¦æ±‚å®ƒçš„é…ç½®è¢«æŒ‡å®šåœ¨ä¸€ä¸ªåŒåå±æ€§ä¸­ã€‚åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­, æˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ª `banner` é€‰é¡¹(ç”¨äºåœ¨æ–‡ä»¶é¡¶éƒ¨ç”Ÿæˆä¸€ä¸ªæ³¨é‡Š)ï¼Œç´§æ¥ç€æ˜¯ä¸€ä¸ªå•ä¸€çš„åä¸º `build` çš„ `uglify` ç›®æ ‡ï¼Œç”¨äºå°†ä¸€ä¸ª JS æ–‡ä»¶å‹ç¼©ä¸ºä¸€ä¸ªç›®æ ‡æ–‡ä»¶ã€‚

```js
// Project configuration.
grunt.initConfig({
  pkg: grunt.file.readJSON('package.json'),
  uglify: {
    options: {
      banner: '/*! <%= pkg.name %> <%= grunt.template.today("yyyy-mm-dd") %> */\n',
    },
    build: {
      src: 'src/<%= pkg.name %>.js',
      dest: 'build/<%= pkg.name %>.min.js',
    },
  },
});
```

### åŠ è½½ Grunt æ’ä»¶å’Œä»»åŠ¡

åƒ concatenationã€minificationã€grunt-contrib-uglify å’Œ linting è¿™äº›å¸¸ç”¨çš„ä»»åŠ¡ï¼ˆtaskï¼‰éƒ½å·²ç»ä»¥ Grunt æ’ä»¶çš„å½¢å¼è¢«å¼€å‘å‡ºæ¥äº†ã€‚åªè¦åœ¨ `package.json` æ–‡ä»¶ä¸­è¢«åˆ—ä¸º `dependency`ï¼ˆä¾èµ–ï¼‰çš„åŒ…ï¼Œå¹¶é€šè¿‡ `npm install` å®‰è£…ä¹‹åï¼Œéƒ½å¯ä»¥åœ¨ Gruntfile ä¸­ä»¥ç®€å•å‘½ä»¤çš„å½¢å¼ä½¿ç”¨ï¼š

```js
// åŠ è½½èƒ½å¤Ÿæä¾›"uglify"ä»»åŠ¡çš„æ’ä»¶ã€‚
grunt.loadNpmTasks('grunt-contrib-uglify');
```

æ³¨æ„ï¼š`grunt --help` å‘½ä»¤å°†åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ä»»åŠ¡ã€‚

### è‡ªå®šä¹‰ä»»åŠ¡

é€šè¿‡å®šä¹‰ `default` ä»»åŠ¡ï¼Œå¯ä»¥è®© Grunt é»˜è®¤æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ã€‚åœ¨ä¸‹é¢çš„è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæ‰§è¡Œ `grunt` å‘½ä»¤æ—¶å¦‚æœä¸æŒ‡å®šä¸€ä¸ªä»»åŠ¡çš„è¯ï¼Œå°†ä¼šæ‰§è¡Œ `uglify` ä»»åŠ¡ã€‚è¿™å’Œæ‰§è¡Œ `grunt uglify` æˆ–è€… `grunt default` çš„æ•ˆæœä¸€æ ·ã€‚`default` ä»»åŠ¡åˆ—è¡¨æ•°ç»„ä¸­å¯ä»¥æŒ‡å®šä»»æ„æ•°ç›®çš„ä»»åŠ¡ï¼ˆå¯ä»¥å¸¦å‚æ•°ï¼‰ã€‚

```js
// Default task(s).
grunt.registerTask('default', ['uglify']);
```

å¦‚æœ Grunt æ’ä»¶ä¸­çš„ä»»åŠ¡ï¼ˆtaskï¼‰ä¸èƒ½æ»¡è¶³ä½ çš„é¡¹ç›®éœ€æ±‚ï¼Œä½ è¿˜å¯ä»¥åœ¨ Gruntfile ä¸­è‡ªå®šä¹‰ä»»åŠ¡ï¼ˆtaskï¼‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„ Gruntfile ä¸­è‡ªå®šä¹‰äº†ä¸€ä¸ª `default` ä»»åŠ¡ï¼Œå¹¶ä¸”ä»–ç”šè‡³ä¸ä¾èµ–ä»»åŠ¡é…ç½®ï¼š

```js
module.exports = function(grunt) {
  // A very basic default task.
  grunt.registerTask('default', 'Log some stuff.', function() {
    grunt.log.write('Logging some stuff...').ok();
  });
};
```

ç‰¹å®šäºé¡¹ç›®çš„ä»»åŠ¡ä¸å¿…åœ¨ Gruntfile ä¸­å®šä¹‰ã€‚ä»–ä»¬å¯ä»¥å®šä¹‰åœ¨å¤–éƒ¨ `.js` æ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡ `grunt.loadTasks` æ–¹æ³•åŠ è½½ã€‚

---

**å‚è€ƒèµ„æ–™ï¼š**

- [ğŸ“ ä½¿ç”¨ Grunt æ„å»ºä»»åŠ¡ç®¡ç†è„šæœ¬](https://www.w3cplus.com/tools/writing-awesome-build-script-grunt.html)
- [ğŸ“ æœ‰å…³ Grunt - è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·çš„å¥‡æŠ€æ·«å·§](https://segmentfault.com/a/1190000005029360)
