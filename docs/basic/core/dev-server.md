---
nav:
  title: åŸºæœ¬ç»¼è¿°
  order: 1
group:
  title: æ ¸å¿ƒæ¦‚å¿µ
  order: 2
title: devServer å¼€å‘æœåŠ¡å™¨
order: 12
---

# devServer å¼€å‘æœåŠ¡å™¨

[ä¸­æ–‡æ–‡æ¡£](https://webpack.docschina.org/configuration/dev-server/)

- æä¾› HTTP æœåŠ¡ï¼Œè€Œéä½¿ç”¨æœ¬åœ°æ–‡ä»¶é¢„è§ˆ
- ç›‘å¬æ–‡ä»¶çš„å˜åŒ–å¹¶è‡ªåŠ¨åˆ·æ–°ç½‘é¡µï¼Œåšåˆ°å®æ—¶é¢„è§ˆ
- æ”¯æŒ SourceMap æ–¹ä¾¿è°ƒè¯•

ğŸ“Œ devServer ä¼šå°† Webpack æ„å»ºå‡ºçš„æ–‡ä»¶ä¿å­˜åœ¨å†…å­˜ä¸­

Webpack åœ¨å¯åŠ¨æ—¶å¯ä»¥å¼€å¯**ç›‘å¬æ¨¡å¼**ï¼Œä¹‹å Webpack ä¼šç›‘å¬æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„å˜åŒ–ï¼Œåœ¨å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°æ„å»ºå‡ºæ–°çš„ç»“æœã€‚Webpack é»˜è®¤å…³é—­ç›‘å¬æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨ Webpack æ—¶é€šè¿‡ `webpack --watch` æ¥å¼€å¯ç›‘å¬æ¨¡å¼ã€‚

é€šè¿‡ devServer å¯åŠ¨çš„ Webpack ä¼šå¼€å¯ç›‘å¬æ¨¡å¼ï¼Œå½“å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°æ‰§è¡Œæ„å»ºï¼Œç„¶åé€šçŸ¥ devServer ä¼šè®© Webpack åœ¨æ„å»ºå‡ºçš„ JavaScript ä»£ç é‡Œæ³¨å…¥ä¸€ä¸ªä»£ç†å®¢æˆ·ç«¯ç”¨äºæ§åˆ¶ç½‘é¡µï¼Œç½‘é¡µå’Œ devServer ä¹‹é—´é€šè¿‡ WebSocket åè®®é€šä¿¡ï¼Œä»¥æ–¹ä¾¿ devServer ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€å‘½ä»¤ã€‚devServer åœ¨æ”¶åˆ°æ¥è‡ª Webpack çš„æ–‡ä»¶å˜åŒ–é€šçŸ¥æ—¶ï¼Œé€šè¿‡æ³¨å…¥çš„å®¢æˆ·ç«¯æ§åˆ¶ç½‘é¡µåˆ·æ–°ã€‚

å¦‚æœå°è¯•ä¿®æ”¹ `index.html` æ–‡ä»¶å¹¶ä¿å­˜ï¼Œåˆ™æˆ‘ä»¬ä¼šå‘ç°è¿™å¹¶ä¸ä¼šè§¦å‘ä»¥ä¸Šæœºåˆ¶ï¼Œå¯¼è‡´è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ Webpack åœ¨å¯åŠ¨æ—¶ä¼šä»¥é…ç½®çš„ entry ä¸ºå…¥å£å»é€’å½’è§£æå‡º entry æ‰€ä¾èµ–çš„æ–‡ä»¶ï¼Œåªæœ‰ entry æœ¬èº«å’Œä¾èµ–çš„æ–‡ä»¶æ‰ä¼šè¢« Webpack æ·»åŠ åˆ°ç›‘å¬åˆ—è¡¨é‡Œã€‚è€Œ `index.html` æ–‡ä»¶æ—¶è„±ç¦»äº† JavaScript æ¨¡å—åŒ–ç³»ç»Ÿçš„ï¼Œæ‰€ä»¥ Webpack ä¸çŸ¥é“ä»–çš„å­˜åœ¨ã€‚

```js
module.exports = {
  // webpack-dev-server å’Œ webpack-dev-middle é‡Œ Watch æ¨¡å¼é»˜è®¤å¼€å¯
  watch: true,

  devServer: {
    // ä»…æ˜¾ç¤ºé”™è¯¯çº§åˆ«çš„è¾“å‡ºï¼Œä»è€Œå‡å°‘è¾“å‡ºä¿¡æ¯
    stats: 'error-only',

    // ä»ç¯å¢ƒå˜é‡ä¸­ä¼ å…¥ host å’Œ portï¼Œä»è€Œè¾¾åˆ°å¯é…ç½®
    //
    // å¦‚æœä½ æ˜¯ç”¨ Dockerã€Vagrant æˆ–è€… Cloud9ï¼Œé‚£ä¹ˆæŠŠ
    // host è®¾ç½®ä¸º "0.0.0.0"
    //
    // 0.0.0.0 å¯¹äºæ‰€æœ‰çš„ç½‘ç»œè®¾å¤‡éƒ½æ˜¯å¯ç”¨çš„
    // è€Œé»˜è®¤çš„ `localhost` ä¸è¡Œ
    host: process.env.HOST, // é»˜è®¤ä¸º `localhost`
    port: process.env.PORT, // é»˜è®¤ä¸º 8080
    open: true, // åœ¨æµè§ˆå™¨æ‰“å¼€
  },
};
```

> `dotenv` å…è®¸ä½ é€šè¿‡ `.env` æ–‡ä»¶å®šä¹‰ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥å¿«é€Ÿæ–¹ä¾¿åœ°è®¾ç½®ä¸»æœºåœ°å€å’Œç«¯å£äº†

> å¦‚æœæ‚¨çš„ç½‘é¡µåº”ç”¨ä½¿ç”¨åŸºäº HTML History API è®°å½•è·¯ç”±ï¼Œä½ å¯ä»¥å¯åŠ¨ `devServer.historyApiFallback`

## æ¨¡å—çƒ­æ›¿æ¢ç‰¹æ€§

`hot` å­—æ®µé…ç½®æ˜¯å¦å¯ç”¨**æ¨¡å—çƒ­æ›¿æ¢**åŠŸèƒ½ã€‚

```js
hot: true;
```

é»˜è®¤è¡Œä¸ºæ˜¯å‘ç°æºç å˜æ›´åè‡ªåŠ¨åˆ·æ–°æ•´ä¸ªé¡µé¢æ¥åšåˆ°å®æ—¶é¢„è§ˆï¼Œå¼€å¯åï¼Œå°†åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹é€šè¿‡æ–°æ¨¡å—æ›¿æ¢è€æ¨¡å—æ¥åšåˆ°å®æ—¶é¢„è§ˆã€‚

é™¤äº†é€šè¿‡é‡æ–°åˆ·æ–°æ•´ä¸ªç½‘é¡µæ¥å®ç°å®æ—¶é¢„è§ˆï¼ŒdevServer è¿˜æœ‰ä¸€ç§è¢«ç§°ä½œæ¨¡å—çƒ­æ›¿æ¢çš„åˆ·æ–°æŠ€æœ¯ã€‚æ¨¡å—çƒ­æ›¿æ¢èƒ½åšåˆ°åœ¨ä¸é‡æ–°åŠ è½½æ•´ä¸ªç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å°†å·±æ›´æ–°çš„æ¨¡å—æ›¿æ¢è€æ¨¡å—ï¼Œå†é‡æ–°æ‰§è¡Œä¸€æ¬¡æ¥å®ç°å®æ—¶é¢„è§ˆã€‚æ¨¡å—çƒ­æ›¿æ¢ç›¸å¯¹äºé»˜è®¤çš„åˆ·æ–°æœºåˆ¶èƒ½æä¾›æ›´å¿«çš„å“åº”é€Ÿåº¦å’Œæ›´å¥½çš„å¼€å‘ä½“éªŒã€‚æ¨¡å—çƒ­æ›¿æ¢é»˜è®¤æ˜¯å…³é—­çš„ï¼Œè¦å¼€å¯æ¨¡å—çƒ­æ›¿æ¢ï¼Œæˆ‘ä»¬åªéœ€åœ¨å¯åŠ¨ devServer æ—¶å¸¦ä¸Š `--hot` å‚æ•°ï¼Œé‡å¯ devServer åå†å»æ›´æ–°æ–‡ä»¶å°±èƒ½ä½“éªŒåˆ°æ¨¡å—çƒ­æ›¿æ¢çš„ç¥å¥‡äº†ã€‚

## æ³¨å…¥é¡µé¢åˆ†æ”¯

devServer çš„å®æ—¶é¢„è§ˆåŠŸèƒ½ä¾èµ–ä¸€ä¸ªæ³¨å…¥é¡µé¢é‡Œçš„ä»£ç†å®¢æˆ·ç«¯ï¼Œå»æ¥æ”¶æ¥è‡ª devServer çš„å‘½ä»¤å¹¶è´Ÿè´£åˆ·æ–°ç½‘é¡µçš„å·¥ä½œã€‚ `devServer.inline` ç”¨äºé…ç½®æ˜¯å¦å°†è¿™ä¸ªä»£ç†å®¢æˆ·ç«¯**è‡ªåŠ¨æ³¨å…¥**å°†è¿è¡Œåœ¨é¡µé¢ä¸­çš„ Chunk é‡Œï¼Œé»˜è®¤è‡ªåŠ¨æ³¨å…¥ã€‚ devServer ä¼šæ ¹æ®æˆ‘ä»¬æ˜¯å¦å¼€å¯ inline æ¥è°ƒæ•´å®ƒçš„è‡ªåŠ¨åˆ·æ–°ç­–ç•¥ã€‚

- å¦‚æœå¼€å¯ inlineï¼Œåˆ™ devServer ä¼šåœ¨æ„å»ºå˜åŒ–åçš„ä»£ç æ—¶é€šè¿‡**ä»£ç†å®¢æˆ·ç«¯**æ§åˆ¶ç½‘é¡µåˆ·æ–°ã€‚
- å¦‚æœå…³é—­ inlineï¼Œåˆ™ devServer å°†æ— æ³•ç›´æ¥æ§åˆ¶è¦å¼€å‘çš„ç½‘é¡µã€‚è¿™æ—¶å®ƒä¼šé€šè¿‡ iframe çš„æ–¹å¼å»è¿è¡Œè¦å¼€å‘çš„ç½‘é¡µã€‚åœ¨æ„å»ºå®Œå˜åŒ–åçš„ä»£ç æ—¶ï¼Œä¼šé€šè¿‡åˆ·æ–° iframe æ¥å®ç°å®æ—¶é¢„è§ˆï¼Œä½†è¿™æ—¶æˆ‘ä»¬éœ€è¦å» `http://localhost:8080/webpackÂ­-dev-server/` å®æ—¶é¢„è§ˆè‡ªå·±çš„ç½‘é¡µã€‚

å¦‚æœæƒ³ä½¿ç”¨ devServer çš„æ¨¡å—çƒ­æ›¿æ¢æœºåˆ¶å»å®ç°å®æ—¶é¢„è§ˆï¼Œåˆ™æœ€æ–¹ä¾¿çš„æ–¹æ³•æ˜¯ç›´æ¥å¼€å¯ inline ã€‚

## å†å²è®°å½•è·¯ç”±

é…ç½®é¡¹ `historyApiFallback` ç”¨äºæ–¹ä¾¿åœ°å¼€å‘ä½¿ç”¨ HTML5 History API çš„å•é¡µåº”ç”¨ã€‚

è¿™ç±»å•é¡µåº”ç”¨è¦æ±‚æœåŠ¡å™¨åœ¨é’ˆå¯¹ä»»ä½•å‘½ä¸­çš„è·¯ç”±æ—¶ï¼Œéƒ½è¿”å›ä¸€ä¸ªå¯¹åº”çš„ HTML æ–‡ä»¶ã€‚

ä¾‹å¦‚åœ¨è®¿é—® `http://localhost/user` å’Œ `http://localhost/home` æ—¶éƒ½è¿”å› `index.html` æ–‡ä»¶ï¼Œæµè§ˆå™¨ç«¯çš„ JavaScript ä»£ç ä¼šä» URL é‡Œè§£æå‡ºå½“å‰é¡µé¢çš„çŠ¶æ€ï¼Œæ˜¾ç¤ºå¯¹åº”çš„ç•Œé¢ã€‚

```js
historyApiFallback: true;
```

åªèƒ½ç”¨äºåªæœ‰ä¸€ä¸ª HTML æ–‡ä»¶çš„åº”ç”¨ã€‚

å¦‚æœæ˜¯å¤šé¡µåº”ç”¨ã€‚

```js
historyApiFallback: {
  // ä½¿ç”¨æ­£åˆ™åŒ¹é…å‘½ä¸­è·¯ç”±
  rewrites: [
    // /user å¼€å¤´çš„éƒ½è¿”å› user.html
    { from: /^\/user/, to: '/user.html' },
    { from: /^\/game/, to: '.game.html' },
    // å…¶ä»–çš„éƒ½è¿”å› index.html
    { from: /./, to: '/index.html' },
  ];
}
```

## æ–‡ä»¶æ ¹ç›®å½•

é…ç½®é¡¹ `contentBase` ç”¨äºé…ç½® devServer HTTP æœåŠ¡å™¨çš„æ–‡ä»¶æ ¹ç›®å½•ã€‚é»˜è®¤ä¸ºå½“å‰æ‰§è¡Œç›®å½•ï¼Œä¸€èˆ¬ä¸å¿…è®¾ç½®ï¼Œé™¤éæœ‰é¢å¤–çš„æ–‡ä»¶éœ€è¦è¢« devServer æœåŠ¡ã€‚

ä¾‹å¦‚å°† `public` ç›®å½•è®¾ç½®æˆ devServer æœåŠ¡å™¨çš„æ–‡ä»¶æ ¹ç›®å½•ã€‚

```js
devServer: {
  contentBase: path.join(__dirname, 'public');
}
```

devServer æœåŠ¡å™¨é€šè¿‡ HTTP æœåŠ¡å™¨æš´éœ²æ–‡ä»¶çš„æ–¹å¼å¯åˆ†ä¸ºä¸¤ç±»ï¼š

- æš´éœ²æœ¬åœ°æ–‡ä»¶
- æš´éœ² Webpack æ„å»ºå‡ºçš„ç»“æœï¼Œç”±äºæ„å»ºå‡ºçš„ç»“æœäº¤ç»™äº† devServerï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨ devServer æ—¶ï¼Œä¼šåœ¨æœ¬åœ°æ‰¾ä¸åˆ°æ„å»ºå‡ºçš„æ–‡ä»¶

## è®¾ç½®å“åº”å¤´

é…ç½®é¡¹ `headers` ç”¨äºé…ç½® HTTP ç›¸åº”ä¸­æ³¨å…¥ä¸€äº› HTTP å“åº”å¤´ã€‚

```js
devServer: {
    headers: {
        'X-foo': 'bar'
    }
}
```

## æœåŠ¡ç›‘å¬åœ°å€

é…ç½®é¡¹ `host` ç”¨äºé…ç½® devServer æœåŠ¡ç›‘å¬çš„åœ°å€ï¼Œåªèƒ½é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ä¼ å…¥ã€‚

## æœåŠ¡ç›‘å¬ç«¯å£

é…ç½®é¡¹ `port` ç”¨äºé…ç½® devServer æœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä½¿ç”¨ 8080 ç«¯å£ã€‚

## ç™½åå•åˆ—è¡¨

é…ç½® `allowedHosts` ç™½åå•åˆ—è¡¨ï¼Œåªæœ‰ HTTP è¯·æ±‚çš„ HOST åœ¨åˆ—è¡¨é‡Œæ‰èƒ½æ­£å¸¸è¿”å›ã€‚

```js
allowedHosts: [
  // åŒ¹é…å•ä¸ªåŸŸå
  'host.com',
  'sub.host.com',
  // host2.com å’Œæ‰€æœ‰çš„å­åŸŸå *.host2.com éƒ½å°†åŒ¹é…
  '.host2.com',
];
```

## HOST æ£€æŸ¥

é…ç½®é¡¹ `disableHostCheck` ç”¨äºé…ç½®æ˜¯å¦å…³é—­ç”¨äº DNS é‡æ–°ç»‘å®šçš„ HTTP è¯·æ±‚çš„ HOST æ£€æŸ¥ã€‚

devServer é»˜è®¤å€¼æ¥æ”¶æ¥è‡ªæœ¬åœ°çš„è¯·æ±‚ï¼Œå…³é—­åå¯ä»¥æ¥æ”¶æ¥è‡ªä»»æ„ HOST çš„è¯·æ±‚ã€‚å®ƒé€šå¸¸ç”¨äºæ­é… `--host 0.0.0.0` ä½¿ç”¨ï¼Œå› ä¸ºæƒ³è®©å…¶ä»–è®¾å¤‡è®¿é—®è‡ªå·±çš„æœ¬åœ°æœåŠ¡ï¼Œä½†è®¿é—®æ—¶æ˜¯ç›´æ¥é€šè¿‡ IP åœ°å€è®¿é—®è€Œä¸æ˜¯é€šè¿‡ HOST è®¿é—®ï¼Œæ‰€ä»¥éœ€è¦å…³é—­ HOST æ£€æŸ¥ã€‚

## HTTPS

devServer é»˜è®¤ä½¿ç”¨ HTTP æœåŠ¡ã€‚

æŸäº›æƒ…å†µå¿…é¡»ä½¿ç”¨ HTTPSï¼Œä¾‹å¦‚ HTTP2 å’Œ ServiceWorker å°±å¿…é¡»è¿è¡Œåœ¨ HTTPS ä¸Šã€‚è‡ªåŠ¨ç”Ÿæˆè¯ä¹¦ã€‚

```js
devServer: {
  https: true;
}
```

å¦‚æœæƒ³ä½¿ç”¨è‡ªå·±çš„è¯ä¹¦ã€‚

```js
devServer: {
    https: {
        key: fs.readFileSync('path/to/server.key'),
        cert: fs.readFileSync('path/to/server.crt'),
        ca: fs.readFileSync('path/to/ca.pem')
    }
}
```

## å®¢æˆ·ç«¯æ—¥å¿—å†…å®¹

é…ç½®å®¢æˆ·ç«¯çš„æ—¥å¿—ç™»è®°ï¼Œè¿™ä¼šå½±å“åˆ°æˆ‘ä»¬åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ§åˆ¶å°é‡Œçœ‹åˆ°çš„æ—¥å¿—å†…å®¹ã€‚

å¯å–å€¼ï¼š

- none - ä¸è¾“å‡º
- error
- warning
- infoï¼ˆé»˜è®¤ï¼‰

## ä¼ è¾“å‹ç¼©

é…ç½®æ˜¯å¦å¯ç”¨ Gzip å‹ç¼©ï¼Œé»˜è®¤ä¸º `false`ã€‚

## é»˜è®¤å¼€å¯æµè§ˆå™¨

å¯åŠ¨é¡¹ç›®åè‡ªåŠ¨æ‰“å¼€ç³»ç»Ÿé»˜è®¤æµè§ˆå™¨ã€‚

## æµè§ˆå™¨æ˜¾ç¤ºç¼–è¯‘å¼‚å¸¸

WDS æä¾›äº† overlay å±æ€§ï¼Œå¼€å¯åå¯ä»¥æ•è·ä¸ç¼–è¯‘ç›¸å…³çš„é”™è¯¯å’Œè­¦å‘Šï¼š

```js
module.exports = {
  devServer: {
    overlay: true,
  },
};
```

> å¦‚æœä½ æƒ³è¦æ›´å…¨é¢çš„æç¤ºä¿¡æ¯ï¼Œè¯·è€ƒè™‘ [error-overlay-webpack-plugin](https://www.npmjs.com/package/error-overlay-webpack-plugin)ï¼Œå› ä¸ºå®ƒæ›´å¥½åœ°æ˜¾ç¤ºäº†é”™è¯¯çš„èµ·æºã€‚

## è½®è¯¢è€Œéç›‘æµ‹æ–‡ä»¶

æœ‰æ—¶ï¼ŒWDS æä¾›çš„æ–‡ä»¶ç›‘æµ‹è®¾ç½®å°†æ— æ³•åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šè¿è¡Œã€‚åœ¨æ—§ç‰ˆæœ¬çš„ Windowsï¼ŒUbuntuï¼ŒVagrant å’Œ Docker ä¸Šå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚å¯ç”¨è½®è¯¢æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼š

```js
const path = require('path');
const webpack = require('webpack');

module.exports = {
  devServer: {
    watchOptions: {
      // é¦–æ¬¡æ›´æ”¹åå»¶è¿Ÿå¤šå°‘æ—¶é—´å†é‡æ–°æ„å»º
      aggregateTimeout: 300,

      // è½®è¯¢çš„æ—¶é—´é—´éš”ï¼ˆå•ä½ msï¼Œæ¥å— Boolean ç±»å‹çš„å€¼ï¼‰
      poll: 1000,
    },
  },
  plugins: [
    // å¿½ç•¥ node_modules ç›®å½•ï¼ŒèŠ‚çœ CPU èµ„æº
    new webpack.WatchIgnorePlugin([path.join(__dirname, 'node_modules')]),
  ],
};
```
